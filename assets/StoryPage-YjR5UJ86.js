import{j as e,a as Pe,u as R,m as Ae,P as L,p as q,d as E,k as _,e as Re}from"./ui-CqCCPo1Y.js";import{r as m}from"./vendor-CsPsgsBv.js";import{u as X,L as V}from"./Layout-LrLnQRNT.js";import{c as ae,B as S,u as Y,a as U,s as v,b as N,T as Te,q as ke,r as Le,v as De}from"./index-Cz0ZLwjf.js";import{A as ze}from"./arrow-left-D5gG3zqs.js";import{A as Q,a as K,b as J}from"./avatar-DNfy2UMe.js";import{C as ie}from"./clock-C9qB3zDw.js";import{H as Me}from"./heart-Du86xLW1.js";import{f as G,T as We}from"./formatDistanceToNow-v83a3VhZ.js";import{b as He,u as Fe,c as ne}from"./query-2sWkym1G.js";import{M as Z}from"./dialog-JXTE8grn.js";import{L as Oe,b as qe,u as Be}from"./router-J7O6VmFe.js";import"./supabase-DoZrjKS4.js";import"./utils-EL5wpLGY.js";import"./constructNow-CztL-i6M.js";import"./en-US-ktNFwBEl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=ae("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ae("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);function Ve({isMobile:t,showComments:r,onClick:s}){return e.jsxs(S,{variant:"ghost",size:"sm",className:`mb-4 flex items-center gap-2 text-[#037004] hover:text-[#025803] hover:bg-[#025803]/10 transition-colors ${t?"mb-2":""}`,onClick:s,children:[e.jsx(ze,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:t&&r?"Back to Story":"Back to Stories"}),e.jsx("span",{className:"sm:hidden",children:t&&r?"Story":"Back"})]})}function Xe(t){const{user:r}=Y(),{toast:s}=U(),[l,o]=m.useState(0),[n,a]=m.useState(!1),[d,i]=m.useState(!1),u=async()=>{try{const{data:x,error:h}=await v.from("story_likes").select("id").eq("story_id",t);if(h)throw h;if(o(x?.length||0),r){const{data:p,error:f}=await v.from("story_likes").select("id").eq("story_id",t).eq("user_id",r.id).single();if(f&&f.code!=="PGRST116")throw f;a(!!p)}}catch(x){console.error("Error fetching likes:",x)}},c=async()=>{if(!r){s({title:"Authentication required",description:"Please log in to like stories",variant:"destructive"});return}i(!0);try{if(n){const{error:x}=await v.from("story_likes").delete().eq("story_id",t).eq("user_id",r.id);if(x)throw x;a(!1),o(h=>h-1)}else{const{error:x}=await v.from("story_likes").insert({story_id:t,user_id:r.id});if(x)throw x;a(!0),o(h=>h+1)}}catch(x){console.error("Error toggling like:",x),s({title:"Error",description:"Failed to update like status",variant:"destructive"})}finally{i(!1)}};return m.useEffect(()=>{u()},[t,r]),{likesCount:l,isLiked:n,isLoading:d,toggleLike:c}}function ce({story:t}){const r=Math.ceil(t.content.split(" ").length/200),{likesCount:s,isLiked:l,isLoading:o,toggleLike:n}=Xe(t.id),a=X(),d=i=>{switch(i){case"mental":return"bg-[#037004] text-white border-[#025803]";case"control":return"bg-blue-500 text-white border-blue-600";case"drugs":return"bg-red-500 text-white border-red-600";case"life":return"bg-orange-500 text-white border-orange-600";case"anxiety":return"bg-purple-500 text-white border-purple-600";case"depression":return"bg-indigo-500 text-white border-indigo-600";default:return"bg-gray-500 text-white border-gray-600"}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:`${a?"p-3":"p-4 sm:p-6"} border-b border-border bg-card flex-shrink-0`,children:[e.jsx("div",{className:"flex flex-col gap-3 mb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("div",{className:`text-xs py-1.5 px-3 rounded-full font-medium shadow-sm w-fit ${d(t.tag_type)}`,children:t.tags[0]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground text-xs",children:[e.jsx(ie,{size:12}),e.jsxs("span",{children:[r," min read"]})]})]})}),e.jsx("h1",{className:`font-bold text-foreground mb-4 leading-tight ${a?"text-lg":"text-xl sm:text-2xl lg:text-3xl"}`,children:t.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Q,{className:`ring-1 ring-[#037004] ${a?"h-8 w-8":"h-9 w-9"}`,children:[e.jsx(K,{src:t.author?.profile_image||void 0}),e.jsx(J,{className:"bg-[#037004] text-white font-semibold text-sm",children:(t.author?.name||"A").charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`font-semibold text-foreground ${a?"text-sm":"text-base"}`,children:t.author?.name||"Anonymous"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Published ",G(new Date(t.published_at),{addSuffix:!0})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("button",{onClick:n,disabled:o,className:N("flex items-center gap-1 px-3 py-1.5 text-xs rounded-full transition-colors","hover:bg-red-500/10 disabled:opacity-50 disabled:cursor-not-allowed",l?"text-red-500 bg-red-500/10":"text-muted-foreground hover:text-red-500"),children:[e.jsx(Me,{size:14,className:N("transition-all",l?"fill-current":"")}),e.jsx("span",{children:s})]})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-background",children:e.jsxs("div",{className:`${a?"p-3":"p-4 sm:p-6"}`,children:[e.jsx("div",{className:"mb-6",children:e.jsx("img",{src:t.cover_image,alt:t.title,className:`w-full rounded-lg object-cover shadow-sm border border-border ${a?"h-40":"h-48 sm:h-64 lg:h-80"}`,onError:i=>{i.target.src="/placeholder.svg"}})}),e.jsx("div",{className:"prose prose-base lg:prose-lg max-w-none",children:e.jsx("div",{className:`text-foreground leading-relaxed space-y-4 ${a?"space-y-3":"space-y-6"}`,children:t.content.split(`

`).map((i,u)=>e.jsx("p",{className:`text-foreground ${a?"text-sm leading-6":"text-base lg:text-lg leading-7 lg:leading-8"}`,children:i},u))})}),e.jsxs("div",{className:`mt-6 pt-4 border-t border-border ${a?"mt-4":"mt-8 pt-6"}`,children:[e.jsx("h3",{className:`font-semibold mb-3 text-foreground ${a?"text-base":"text-lg mb-4"}`,children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((i,u)=>e.jsxs("span",{className:`px-3 py-1.5 bg-[#037004]/20 text-[#037004] dark:text-[#4ade80] rounded-full font-medium hover:bg-[#037004]/30 transition-colors cursor-pointer border border-[#037004]/30 ${a?"text-xs":"text-sm"}`,children:["#",i]},u))})]})]})})]})}function Ye(t){const{user:r}=Y(),{toast:s}=U(),l=He(),{data:o=[],isLoading:n}=Fe({queryKey:["comments",t],queryFn:async()=>{const{data:i,error:u}=await v.from("story_comments").select(`
          *,
          users!user_id (
            name,
            profile_image
          )
        `).eq("story_id",t).order("created_at",{ascending:!0});if(u)throw u;let c=[];if(r){const{data:f,error:g}=await v.from("comment_votes").select("comment_id, vote_type").eq("user_id",r.id).in("comment_id",i?.map(T=>T.id)||[]);g||(c=f||[])}const x=(i||[]).map(f=>({id:f.id,story_id:f.story_id,user_id:f.user_id,parent_comment_id:f.parent_comment_id,content:f.content,upvotes:f.upvotes,downvotes:f.downvotes,is_edited:f.is_edited,created_at:f.created_at,updated_at:f.updated_at,author:f.users?{name:f.users.name,profile_image:f.users.profile_image}:void 0,user_vote:c.find(g=>g.comment_id===f.id)?.vote_type||null})),h=new Map,p=[];return x.forEach(f=>{h.set(f.id,{...f,replies:[]})}),x.forEach(f=>{if(f.parent_comment_id){const g=h.get(f.parent_comment_id);g&&g.replies.push(h.get(f.id))}else p.push(h.get(f.id))}),p},enabled:!!t}),a=ne({mutationFn:async({content:i,parentCommentId:u})=>{if(!r)throw new Error("Must be logged in to comment");const{data:c,error:x}=await v.from("story_comments").insert({story_id:t,user_id:r.id,parent_comment_id:u||null,content:i}).select().single();if(x)throw x;return c},onSuccess:()=>{l.invalidateQueries({queryKey:["comments",t]}),s({title:"Comment posted",description:"Your comment has been added successfully."})},onError:i=>{s({title:"Failed to post comment",description:i.message||"Could not post your comment",variant:"destructive"})}}),d=ne({mutationFn:async({commentId:i,voteType:u})=>{if(!r)throw new Error("Must be logged in to vote");if(u===null){const{error:c}=await v.from("comment_votes").delete().eq("comment_id",i).eq("user_id",r.id);if(c)throw c}else{const{error:c}=await v.from("comment_votes").upsert({comment_id:i,user_id:r.id,vote_type:u});if(c)throw c}},onSuccess:()=>{l.invalidateQueries({queryKey:["comments",t]})},onError:i=>{s({title:"Failed to vote",description:i.message||"Could not register your vote",variant:"destructive"})}});return{comments:o,isLoading:n,addComment:a.mutate,voteComment:d.mutate,isAddingComment:a.isPending,isVoting:d.isPending}}function de({onSubmit:t,onCancel:r,placeholder:s="Write a comment...",submitText:l="Post Comment",isSubmitting:o=!1,isReply:n=!1}){const[a,d]=m.useState(""),{isAuthenticated:i}=Y(),u=c=>{c.preventDefault(),a.trim()&&(t(a.trim()),d(""))};return i?e.jsxs("form",{onSubmit:u,className:"space-y-3",children:[e.jsx(Te,{value:a,onChange:c=>d(c.target.value),placeholder:s,className:"min-h-[80px] resize-none",disabled:o}),e.jsxs("div",{className:"flex justify-end gap-2",children:[r&&e.jsx(S,{type:"button",variant:"outline",onClick:r,disabled:o,children:"Cancel"}),e.jsx(S,{type:"submit",disabled:!a.trim()||o,size:n?"sm":"default",className:"bg-[#037004] hover:bg-[#025803] text-white",children:o?"Posting...":l})]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground bg-muted rounded-lg border border-border",children:[e.jsx(Z,{className:"mx-auto h-8 w-8 mb-2 opacity-50"}),e.jsx("p",{children:"Please log in to join the discussion"})]})}function ue({comment:t,onVote:r,onReply:s,isVoting:l=!1,isReplying:o=!1,depth:n=0}){const[a,d]=m.useState(!1),[i,u]=m.useState(!1),c=f=>{const g=t.user_vote===f?null:f;r(t.id,g)},x=f=>{s(t.id,f),d(!1)},h=t.upvotes-t.downvotes;return e.jsxs("div",{className:N("space-y-3",n>0&&"ml-6 border-l-2 border-gray-100 pl-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Q,{className:"h-6 w-6",children:[e.jsx(K,{src:t.author?.profile_image||void 0}),e.jsx(J,{className:"text-xs",children:t.author?.name?.charAt(0)||"A"})]}),e.jsx("span",{className:"font-medium text-sm",children:t.author?.name||"Anonymous"}),e.jsx("span",{className:"text-xs text-gray-500",children:G(new Date(t.created_at),{addSuffix:!0})}),t.is_edited&&e.jsx("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:t.content}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{variant:"ghost",size:"sm",className:N("h-6 px-1",t.user_vote==="upvote"&&"text-orange-500 bg-orange-50"),onClick:()=>c("upvote"),disabled:l,children:e.jsx(ke,{size:14})}),e.jsx("span",{className:N("text-xs font-medium min-w-[20px] text-center",h>0&&"text-orange-500",h<0&&"text-blue-500"),children:h}),e.jsx(S,{variant:"ghost",size:"sm",className:N("h-6 px-1",t.user_vote==="downvote"&&"text-blue-500 bg-blue-50"),onClick:()=>c("downvote"),disabled:l,children:e.jsx(Le,{size:14})})]}),n<6&&e.jsxs(S,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>d(!a),children:[e.jsx($e,{size:12,className:"mr-1"}),"Reply"]}),t.replies&&t.replies.length>0&&e.jsx(S,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>u(!i),children:i?`[+] ${t.replies.length} replies`:"[-]"}),e.jsx(S,{variant:"ghost",size:"sm",className:"h-6 px-1",children:e.jsx(Ie,{size:12})})]})]}),i&&e.jsxs(S,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-gray-500",onClick:()=>u(!1),children:["[+] ",t.author?.name," (",h," points) - ",t.replies?.length||0," replies"]}),a&&!i&&e.jsx("div",{className:"mt-3",children:e.jsx(de,{onSubmit:x,onCancel:()=>d(!1),placeholder:"Write a reply...",submitText:"Reply",isSubmitting:o,isReply:!0})})]}),!i&&t.replies&&t.replies.length>0&&e.jsx("div",{className:"space-y-3",children:t.replies.map(f=>e.jsx(ue,{comment:f,onVote:r,onReply:s,isVoting:l,isReplying:o,depth:n+1},f.id))})]})}function Ue(t,r){return m.useReducer((s,l)=>r[s][l]??s,t)}var ee="ScrollArea",[me,Et]=Pe(ee),[Qe,w]=me(ee),he=m.forwardRef((t,r)=>{const{__scopeScrollArea:s,type:l="hover",dir:o,scrollHideDelay:n=600,...a}=t,[d,i]=m.useState(null),[u,c]=m.useState(null),[x,h]=m.useState(null),[p,f]=m.useState(null),[g,T]=m.useState(null),[C,D]=m.useState(0),[$,z]=m.useState(0),[M,k]=m.useState(!1),[W,H]=m.useState(!1),b=R(r,P=>i(P)),j=Ae(o);return e.jsx(Qe,{scope:s,type:l,dir:j,scrollHideDelay:n,scrollArea:d,viewport:u,onViewportChange:c,content:x,onContentChange:h,scrollbarX:p,onScrollbarXChange:f,scrollbarXEnabled:M,onScrollbarXEnabledChange:k,scrollbarY:g,onScrollbarYChange:T,scrollbarYEnabled:W,onScrollbarYEnabledChange:H,onCornerWidthChange:D,onCornerHeightChange:z,children:e.jsx(L.div,{dir:j,...a,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":$+"px",...t.style}})})});he.displayName=ee;var xe="ScrollAreaViewport",fe=m.forwardRef((t,r)=>{const{__scopeScrollArea:s,children:l,asChild:o,nonce:n,...a}=t,d=w(xe,s),i=m.useRef(null),u=R(r,i,d.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:n}),e.jsx(L.div,{"data-radix-scroll-area-viewport":"",...a,asChild:o,ref:u,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...t.style},children:nt({asChild:o,children:l},c=>e.jsx("div",{"data-radix-scroll-area-content":"",ref:d.onContentChange,style:{minWidth:d.scrollbarXEnabled?"fit-content":void 0},children:c}))})]})});fe.displayName=xe;var y="ScrollAreaScrollbar",te=m.forwardRef((t,r)=>{const{forceMount:s,...l}=t,o=w(y,t.__scopeScrollArea),{onScrollbarXEnabledChange:n,onScrollbarYEnabledChange:a}=o,d=t.orientation==="horizontal";return m.useEffect(()=>(d?n(!0):a(!0),()=>{d?n(!1):a(!1)}),[d,n,a]),o.type==="hover"?e.jsx(Ke,{...l,ref:r,forceMount:s}):o.type==="scroll"?e.jsx(Je,{...l,ref:r,forceMount:s}):o.type==="auto"?e.jsx(pe,{...l,ref:r,forceMount:s}):o.type==="always"?e.jsx(re,{...l,ref:r}):null});te.displayName=y;var Ke=m.forwardRef((t,r)=>{const{forceMount:s,...l}=t,o=w(y,t.__scopeScrollArea),[n,a]=m.useState(!1);return m.useEffect(()=>{const d=o.scrollArea;let i=0;if(d){const u=()=>{window.clearTimeout(i),a(!0)},c=()=>{i=window.setTimeout(()=>a(!1),o.scrollHideDelay)};return d.addEventListener("pointerenter",u),d.addEventListener("pointerleave",c),()=>{window.clearTimeout(i),d.removeEventListener("pointerenter",u),d.removeEventListener("pointerleave",c)}}},[o.scrollArea,o.scrollHideDelay]),e.jsx(q,{present:s||n,children:e.jsx(pe,{"data-state":n?"visible":"hidden",...l,ref:r})})}),Je=m.forwardRef((t,r)=>{const{forceMount:s,...l}=t,o=w(y,t.__scopeScrollArea),n=t.orientation==="horizontal",a=I(()=>i("SCROLL_END"),100),[d,i]=Ue("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return m.useEffect(()=>{if(d==="idle"){const u=window.setTimeout(()=>i("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(u)}},[d,o.scrollHideDelay,i]),m.useEffect(()=>{const u=o.viewport,c=n?"scrollLeft":"scrollTop";if(u){let x=u[c];const h=()=>{const p=u[c];x!==p&&(i("SCROLL"),a()),x=p};return u.addEventListener("scroll",h),()=>u.removeEventListener("scroll",h)}},[o.viewport,n,i,a]),e.jsx(q,{present:s||d!=="hidden",children:e.jsx(re,{"data-state":d==="hidden"?"hidden":"visible",...l,ref:r,onPointerEnter:E(t.onPointerEnter,()=>i("POINTER_ENTER")),onPointerLeave:E(t.onPointerLeave,()=>i("POINTER_LEAVE"))})})}),pe=m.forwardRef((t,r)=>{const s=w(y,t.__scopeScrollArea),{forceMount:l,...o}=t,[n,a]=m.useState(!1),d=t.orientation==="horizontal",i=I(()=>{if(s.viewport){const u=s.viewport.offsetWidth<s.viewport.scrollWidth,c=s.viewport.offsetHeight<s.viewport.scrollHeight;a(d?u:c)}},10);return A(s.viewport,i),A(s.content,i),e.jsx(q,{present:l||n,children:e.jsx(re,{"data-state":n?"visible":"hidden",...o,ref:r})})}),re=m.forwardRef((t,r)=>{const{orientation:s="vertical",...l}=t,o=w(y,t.__scopeScrollArea),n=m.useRef(null),a=m.useRef(0),[d,i]=m.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=je(d.viewport,d.content),c={...l,sizes:d,onSizesChange:i,hasThumb:u>0&&u<1,onThumbChange:h=>n.current=h,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:h=>a.current=h};function x(h,p){return st(h,a.current,d,p)}return s==="horizontal"?e.jsx(Ge,{...c,ref:r,onThumbPositionChange:()=>{if(o.viewport&&n.current){const h=o.viewport.scrollLeft,p=le(h,d,o.dir);n.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollLeft=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollLeft=x(h,o.dir))}}):s==="vertical"?e.jsx(Ze,{...c,ref:r,onThumbPositionChange:()=>{if(o.viewport&&n.current){const h=o.viewport.scrollTop,p=le(h,d);n.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollTop=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollTop=x(h))}}):null}),Ge=m.forwardRef((t,r)=>{const{sizes:s,onSizesChange:l,...o}=t,n=w(y,t.__scopeScrollArea),[a,d]=m.useState(),i=m.useRef(null),u=R(r,i,n.onScrollbarXChange);return m.useEffect(()=>{i.current&&d(getComputedStyle(i.current))},[i]),e.jsx(ge,{"data-orientation":"horizontal",...o,ref:u,sizes:s,style:{bottom:0,left:n.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:n.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":B(s)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.x),onDragScroll:c=>t.onDragScroll(c.x),onWheelScroll:(c,x)=>{if(n.viewport){const h=n.viewport.scrollLeft+c.deltaX;t.onWheelScroll(h),ye(h,x)&&c.preventDefault()}},onResize:()=>{i.current&&n.viewport&&a&&l({content:n.viewport.scrollWidth,viewport:n.viewport.offsetWidth,scrollbar:{size:i.current.clientWidth,paddingStart:O(a.paddingLeft),paddingEnd:O(a.paddingRight)}})}})}),Ze=m.forwardRef((t,r)=>{const{sizes:s,onSizesChange:l,...o}=t,n=w(y,t.__scopeScrollArea),[a,d]=m.useState(),i=m.useRef(null),u=R(r,i,n.onScrollbarYChange);return m.useEffect(()=>{i.current&&d(getComputedStyle(i.current))},[i]),e.jsx(ge,{"data-orientation":"vertical",...o,ref:u,sizes:s,style:{top:0,right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":B(s)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.y),onDragScroll:c=>t.onDragScroll(c.y),onWheelScroll:(c,x)=>{if(n.viewport){const h=n.viewport.scrollTop+c.deltaY;t.onWheelScroll(h),ye(h,x)&&c.preventDefault()}},onResize:()=>{i.current&&n.viewport&&a&&l({content:n.viewport.scrollHeight,viewport:n.viewport.offsetHeight,scrollbar:{size:i.current.clientHeight,paddingStart:O(a.paddingTop),paddingEnd:O(a.paddingBottom)}})}})}),[et,be]=me(y),ge=m.forwardRef((t,r)=>{const{__scopeScrollArea:s,sizes:l,hasThumb:o,onThumbChange:n,onThumbPointerUp:a,onThumbPointerDown:d,onThumbPositionChange:i,onDragScroll:u,onWheelScroll:c,onResize:x,...h}=t,p=w(y,s),[f,g]=m.useState(null),T=R(r,b=>g(b)),C=m.useRef(null),D=m.useRef(""),$=p.viewport,z=l.content-l.viewport,M=_(c),k=_(i),W=I(x,10);function H(b){if(C.current){const j=b.clientX-C.current.left,P=b.clientY-C.current.top;u({x:j,y:P})}}return m.useEffect(()=>{const b=j=>{const P=j.target;f?.contains(P)&&M(j,z)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[$,f,z,M]),m.useEffect(k,[l,k]),A(f,W),A(p.content,W),e.jsx(et,{scope:s,scrollbar:f,hasThumb:o,onThumbChange:_(n),onThumbPointerUp:_(a),onThumbPositionChange:k,onThumbPointerDown:_(d),children:e.jsx(L.div,{...h,ref:T,style:{position:"absolute",...h.style},onPointerDown:E(t.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),C.current=f.getBoundingClientRect(),D.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),H(b))}),onPointerMove:E(t.onPointerMove,H),onPointerUp:E(t.onPointerUp,b=>{const j=b.target;j.hasPointerCapture(b.pointerId)&&j.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=D.current,p.viewport&&(p.viewport.style.scrollBehavior=""),C.current=null})})})}),F="ScrollAreaThumb",ve=m.forwardRef((t,r)=>{const{forceMount:s,...l}=t,o=be(F,t.__scopeScrollArea);return e.jsx(q,{present:s||o.hasThumb,children:e.jsx(tt,{ref:r,...l})})}),tt=m.forwardRef((t,r)=>{const{__scopeScrollArea:s,style:l,...o}=t,n=w(F,s),a=be(F,s),{onThumbPositionChange:d}=a,i=R(r,x=>a.onThumbChange(x)),u=m.useRef(),c=I(()=>{u.current&&(u.current(),u.current=void 0)},100);return m.useEffect(()=>{const x=n.viewport;if(x){const h=()=>{if(c(),!u.current){const p=ot(x,d);u.current=p,d()}};return d(),x.addEventListener("scroll",h),()=>x.removeEventListener("scroll",h)}},[n.viewport,c,d]),e.jsx(L.div,{"data-state":a.hasThumb?"visible":"hidden",...o,ref:i,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...l},onPointerDownCapture:E(t.onPointerDownCapture,x=>{const p=x.target.getBoundingClientRect(),f=x.clientX-p.left,g=x.clientY-p.top;a.onThumbPointerDown({x:f,y:g})}),onPointerUp:E(t.onPointerUp,a.onThumbPointerUp)})});ve.displayName=F;var se="ScrollAreaCorner",we=m.forwardRef((t,r)=>{const s=w(se,t.__scopeScrollArea),l=!!(s.scrollbarX&&s.scrollbarY);return s.type!=="scroll"&&l?e.jsx(rt,{...t,ref:r}):null});we.displayName=se;var rt=m.forwardRef((t,r)=>{const{__scopeScrollArea:s,...l}=t,o=w(se,s),[n,a]=m.useState(0),[d,i]=m.useState(0),u=!!(n&&d);return A(o.scrollbarX,()=>{const c=o.scrollbarX?.offsetHeight||0;o.onCornerHeightChange(c),i(c)}),A(o.scrollbarY,()=>{const c=o.scrollbarY?.offsetWidth||0;o.onCornerWidthChange(c),a(c)}),u?e.jsx(L.div,{...l,ref:r,style:{width:n,height:d,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function O(t){return t?parseInt(t,10):0}function je(t,r){const s=t/r;return isNaN(s)?0:s}function B(t){const r=je(t.viewport,t.content),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,l=(t.scrollbar.size-s)*r;return Math.max(l,18)}function st(t,r,s,l="ltr"){const o=B(s),n=o/2,a=r||n,d=o-a,i=s.scrollbar.paddingStart+a,u=s.scrollbar.size-s.scrollbar.paddingEnd-d,c=s.content-s.viewport,x=l==="ltr"?[0,c]:[c*-1,0];return Se([i,u],x)(t)}function le(t,r,s="ltr"){const l=B(r),o=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=r.scrollbar.size-o,a=r.content-r.viewport,d=n-l,i=s==="ltr"?[0,a]:[a*-1,0],u=De(t,i);return Se([0,a],[0,d])(u)}function Se(t,r){return s=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const l=(r[1]-r[0])/(t[1]-t[0]);return r[0]+l*(s-t[0])}}function ye(t,r){return t>0&&t<r}var ot=(t,r=()=>{})=>{let s={left:t.scrollLeft,top:t.scrollTop},l=0;return function o(){const n={left:t.scrollLeft,top:t.scrollTop},a=s.left!==n.left,d=s.top!==n.top;(a||d)&&r(),s=n,l=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(l)};function I(t,r){const s=_(t),l=m.useRef(0);return m.useEffect(()=>()=>window.clearTimeout(l.current),[]),m.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(s,r)},[s,r])}function A(t,r){const s=_(r);Re(()=>{let l=0;if(t){const o=new ResizeObserver(()=>{cancelAnimationFrame(l),l=window.requestAnimationFrame(s)});return o.observe(t),()=>{window.cancelAnimationFrame(l),o.unobserve(t)}}},[t,s])}function nt(t,r){const{asChild:s,children:l}=t;if(!s)return typeof r=="function"?r(l):r;const o=m.Children.only(l);return m.cloneElement(o,{children:typeof r=="function"?r(o.props.children):r})}var Ne=he,lt=fe,at=we;const oe=m.forwardRef(({className:t,children:r,...s},l)=>e.jsxs(Ne,{ref:l,className:N("relative overflow-hidden",t),...s,children:[e.jsx(lt,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(Ce,{}),e.jsx(at,{})]}));oe.displayName=Ne.displayName;const Ce=m.forwardRef(({className:t,orientation:r="vertical",...s},l)=>e.jsx(te,{ref:l,orientation:r,className:N("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-1.5 border-l border-l-transparent p-[1px] opacity-0 hover:opacity-100",r==="horizontal"&&"h-1.5 flex-col border-t border-t-transparent p-[1px] opacity-0 hover:opacity-100",t),...s,children:e.jsx(ve,{className:"relative flex-1 rounded-full bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors"})}));Ce.displayName=te.displayName;function _e({storyId:t}){const{comments:r,isLoading:s,addComment:l,voteComment:o,isAddingComment:n,isVoting:a}=Ye(t),d=c=>{l({content:c})},i=(c,x)=>{l({content:x,parentCommentId:c})},u=(c,x)=>{o({commentId:c,voteType:x})};return s?e.jsx("div",{className:"h-full flex items-center justify-center p-4",children:e.jsx("div",{className:"text-center text-[#037004]",children:"Loading comments..."})}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"p-3 border-b border-border bg-muted flex-shrink-0",children:e.jsx(de,{onSubmit:d,isSubmitting:n})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(oe,{className:"h-full",children:r.length===0?e.jsxs("div",{className:"text-center py-6 px-4 text-muted-foreground",children:[e.jsx(Z,{className:"mx-auto h-8 w-8 mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No comments yet. Be the first to share your thoughts!"})]}):e.jsx("div",{className:"p-3 space-y-3",children:r.map(c=>e.jsx(ue,{comment:c,onVote:u,onReply:i,isVoting:a,isReplying:n},c.id))})})})]})}function Ee({currentStory:t}){const[r,s]=m.useState([]),[l,o]=m.useState(!0);return m.useEffect(()=>{(async()=>{try{const{data:a,error:d}=await v.from("stories").select("*").eq("tag_type",t.tag_type).neq("id",t.id).limit(5);if(d)throw d;const i=(a||[]).map(u=>{const c=u.tag_type;return{...u,tag_type:c,author:{name:"Anonymous",profile_image:null}}});s(i)}catch(a){console.error("Error fetching similar stories:",a)}finally{o(!1)}})()},[t.tag_type,t.id]),l?e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]},n))})}):r.length===0?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(We,{className:"mx-auto h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No similar stories found"})]}):e.jsx(oe,{className:"h-full",children:e.jsx("div",{className:"p-3 space-y-3",children:r.map((n,a)=>e.jsx(Oe,{to:`/story/${n.id}`,className:"block group",children:e.jsx("div",{className:"p-3 rounded-lg border border-border hover:border-[#037004] hover:bg-accent transition-all duration-200 group-hover:shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(Q,{className:"h-7 w-7",children:[e.jsx(K,{src:n.author?.profile_image||void 0}),e.jsx(J,{className:"bg-[#037004] text-white text-xs",children:(n.author?.name||"A").charAt(0)})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-foreground text-sm line-clamp-2 group-hover:text-[#037004] transition-colors mb-1",children:n.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:n.snippet}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:n.author?.name||"Anonymous"}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{size:10}),e.jsx("span",{children:G(new Date(n.published_at),{addSuffix:!0})})]})]}),e.jsx("span",{className:"text-white text-xs py-0.5 px-2 rounded-full font-medium flex-shrink-0 bg-[#037004]",children:n.tags[0]})]})]})]})})},n.id))})})}function it({story:t}){const[r,s]=m.useState(!1);return e.jsx("div",{className:"space-y-4",children:r?e.jsxs("div",{className:"bg-card rounded-lg shadow-sm border border-border min-h-[calc(100vh-8rem)]",children:[e.jsxs("div",{className:"p-3 border-b border-border bg-muted",children:[e.jsx("h3",{className:"font-semibold text-[#037004] text-lg",children:"Discussion"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Join the conversation about "',t.title,'"']})]}),e.jsx("div",{className:"h-[calc(100vh-12rem)]",children:e.jsx(_e,{storyId:t.id})}),e.jsx("div",{className:"mt-3 flex justify-center",children:e.jsx(S,{variant:"outline",size:"sm",onClick:()=>s(!1),className:"text-[#037004] border-[#037004]",children:"Back to Story"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-card rounded-lg shadow-sm border border-border overflow-hidden",children:e.jsx(ce,{story:t})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(S,{onClick:()=>s(!0),className:"bg-[#037004] hover:bg-[#025803] text-white flex items-center gap-2 px-6 py-3 rounded-full shadow-lg",children:[e.jsx(Z,{size:18}),e.jsx("span",{children:"View Comments & Discussion"})]})}),e.jsxs("div",{className:"bg-card rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"p-3 border-b border-border bg-muted",children:[e.jsx("h3",{className:"font-semibold text-[#037004] text-lg",children:"Similar Stories"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"More stories you might like"})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:e.jsx(Ee,{currentStory:t})})]})]})})}function ct({story:t}){return X()?e.jsx(it,{story:t}):e.jsxs("div",{className:"flex gap-6 h-[calc(100vh-8rem)]",children:[e.jsx("div",{className:"flex-1 lg:w-2/3 flex flex-col min-h-0",children:e.jsx("div",{className:"bg-card rounded-xl shadow-sm border border-border flex-1 flex flex-col overflow-hidden",children:e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx(ce,{story:t}),e.jsxs("div",{className:"border-t border-border mt-4",children:[e.jsxs("div",{className:"p-6 bg-muted border-b border-border",children:[e.jsx("h3",{className:"font-semibold text-[#037004] text-xl",children:"Similar Stories"}),e.jsx("p",{className:"text-base text-muted-foreground",children:"More stories you might like"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto bg-card",children:e.jsx(Ee,{currentStory:t})})]})]})})}),e.jsx("div",{className:"lg:w-1/3 flex flex-col min-h-0",children:e.jsxs("div",{className:"bg-card rounded-xl shadow-sm border border-border flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-border bg-muted flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-[#037004] text-xl",children:"Discussion"}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Join the conversation"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(_e,{storyId:t.id})})]})})]})}function Pt(){const{storyId:t}=qe(),r=Be(),{toast:s}=U(),[l,o]=m.useState(null),[n,a]=m.useState(!0);m.useState(!1);const d=X();return m.useEffect(()=>{(async()=>{try{if(!t){r("/");return}const{data:u,error:c}=await v.from("stories").select("*").eq("id",t).single();if(c)throw c;if(u){let x={name:"Anonymous",profile_image:null};if(u.author_id){const{data:f,error:g}=await v.from("users").select("name, profile_image").eq("id",u.author_id).single();!g&&f&&(x=f)}const h=u.tag_type,p={...u,tag_type:h,author:x};o(p),document.title=`${u.title} | Our Minds`}else r("/")}catch(u){console.error("Error fetching story:",u),s({title:"Failed to load story",description:u.message||"Could not retrieve the story",variant:"destructive"}),r("/")}finally{a(!1)}})()},[t,r,s]),n?e.jsx(V,{children:e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto p-4 lg:p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-pulse text-[#037004]",children:"Loading story..."})})})})}):l?e.jsx(V,{children:e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:`container mx-auto max-w-7xl ${d?"p-2":"p-4 lg:p-6"}`,children:[e.jsx(Ve,{isMobile:d,showComments:!1,onClick:()=>{r(-1)}}),e.jsx(ct,{story:l})]})})}):e.jsx(V,{children:e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto p-4 lg:p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"Story not found"})})})})})}export{Pt as StoryPage,Pt as default};
