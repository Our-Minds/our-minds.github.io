import{j as e}from"./ui-BG7jjlrC.js";import{u as y}from"./query-C_TmXHuV.js";import{u as w,s as d,C as x,h as f,i as p,k as j,U as v,M as S,o as N,j as b}from"./index-Xuc-BpSe.js";import{S as u}from"./skeleton-Z9ohIe8T.js";import{F as D,U as A,C as U}from"./AdminPanel-KnJqQwXs.js";import{c as C}from"./constructNow-CbkWqtaZ.js";import{s as g,f as h}from"./format-Dmqbz6eD.js";import{t as T,f as M}from"./en-US-DcT3sm5m.js";import"./vendor-CsPsgsBv.js";import"./router-J7O6VmFe.js";import"./utils-EL5wpLGY.js";import"./supabase-DoZrjKS4.js";import"./tabs-DOPChhVJ.js";function $(t,r){const s=T(t);return isNaN(r)?M(t,NaN):(s.setDate(s.getDate()+r),s)}function _(t,r){const s=g(t),a=g(r);return+s==+a}function F(t){return _(t,C(t))}function O(t,r){return $(t,-r)}function k(t){return _(t,O(C(t),1))}const L=()=>{const{isAdmin:t}=w();return y({queryKey:["dashboard-stats"],queryFn:async()=>{if(!t)throw new Error("Unauthorized");try{const{count:r,error:s}=await d.from("users").select("*",{count:"exact",head:!0});if(s)throw console.error("Error fetching user count:",s),s;const a=new Date;a.setDate(a.getDate()-7);const{count:o,error:i}=await d.from("stories").select("*",{count:"exact",head:!0}).gte("created_at",a.toISOString());if(i)throw console.error("Error fetching recent stories count:",i),i;const{count:l,error:c}=await d.from("consultants").select("*",{count:"exact",head:!0}).eq("available",!1);if(c)throw console.error("Error fetching pending approvals count:",c),c;return{totalUsers:r||0,recentStories:o||0,pendingApprovals:l||0}}catch(r){throw console.error("Error in useDashboardStats:",r),r}},enabled:!!t,retry:2,retryDelay:1e3})},R=()=>{const{isAdmin:t}=w();return y({queryKey:["recent-activities"],queryFn:async()=>{if(!t)throw new Error("Unauthorized");try{const{data:r,error:s}=await d.from("users").select("id, name, created_at").order("created_at",{ascending:!1}).limit(3);if(s)throw console.error("Error fetching recent users:",s),s;const{data:a,error:o}=await d.from("stories").select("id, title, created_at").order("created_at",{ascending:!1}).limit(3);if(o)throw console.error("Error fetching recent stories:",o),o;const{data:i,error:l}=await d.from("sessions").select("id, user_id, consultant_id, start_time, created_at").order("created_at",{ascending:!1}).limit(2);if(l)throw console.error("Error fetching recent sessions:",l),l;const c=[...(r||[]).map(n=>({id:`user-${n.id}`,type:"user_joined",text:`New user ${n.name||"Anonymous"} joined the platform`,timestamp:n.created_at})),...(a||[]).map(n=>({id:`story-${n.id}`,type:"story_published",text:`New story "${n.title||"Untitled"}" was published`,timestamp:n.created_at})),...(i||[]).map(n=>({id:`session-${n.id}`,type:"session_booked",text:"New consultation session was booked",timestamp:n.created_at}))];return c.sort((n,E)=>new Date(E.timestamp).getTime()-new Date(n.timestamp).getTime()),c.slice(0,5)}catch(r){throw console.error("Error in useRecentActivities:",r),r}},enabled:!!t,retry:2,retryDelay:1e3})},m=({title:t,value:r,icon:s,trend:a})=>e.jsxs(x,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:t}),s]}),e.jsxs(j,{children:[r===void 0?e.jsx(u,{className:"h-7 w-16"}):e.jsx("div",{className:"text-2xl font-bold",children:r.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a})]})]}),q=({stats:t,isLoading:r})=>e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(m,{title:"Total Users",value:r?void 0:t?.totalUsers,icon:e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),trend:"+10% from last month"}),e.jsx(m,{title:"Active Stories",value:r?void 0:t?.recentStories,icon:e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),trend:"+20% from last month"}),e.jsx(m,{title:"Pending Approvals",value:r?void 0:t?.pendingApprovals,icon:e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),trend:`${t?.pendingApprovals?t.pendingApprovals:0} consultants waiting`}),e.jsx(m,{title:"Chat Messages",value:57,icon:e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),trend:"+15% from last month"}),e.jsx(m,{title:"Sessions",value:128,icon:e.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),trend:"+8% from last month"})]}),z=({activities:t})=>{const r=a=>{switch(a){case"user_joined":return e.jsx(v,{className:"h-4 w-4"});case"story_published":return e.jsx(D,{className:"h-4 w-4"});case"session_booked":return e.jsx(N,{className:"h-4 w-4"});default:return null}},s=a=>{const o=new Date(a);return F(o)?`Today at ${h(o,"h:mm a")}`:k(o)?`Yesterday at ${h(o,"h:mm a")}`:h(o,"MMM d, yyyy")};return e.jsx("div",{className:"space-y-4",children:t.length===0?e.jsx("p",{className:"text-center py-4 text-muted-foreground",children:"No recent activity"}):t.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-muted rounded-md",children:[e.jsx("div",{className:"flex items-center justify-center h-8 w-8 rounded-full bg-muted",children:r(a.type)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:a.text}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s(a.timestamp)})]})]},a.id))})},I=({activities:t,isLoading:r,error:s})=>e.jsxs(x,{className:"col-span-full",children:[e.jsxs(f,{children:[e.jsx(p,{children:"Recent Activity"}),e.jsx(b,{children:"Platform activities from the last few days"})]}),e.jsx(j,{children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"h-12 w-full"}),e.jsx(u,{className:"h-12 w-full"}),e.jsx(u,{className:"h-12 w-full"})]}):s?e.jsx("p",{className:"text-center py-4 text-muted-foreground",children:"Failed to load recent activities"}):e.jsx(z,{activities:t||[]})})]}),P=()=>e.jsxs(x,{className:"col-span-full",children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Monthly Overview"}),e.jsx(b,{children:"Platform performance metrics for the past 30 days"})]}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]})}),e.jsx(j,{children:e.jsx("div",{className:"h-[200px] w-full rounded-md bg-muted/30 flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Chart visualization will appear here"})})})]}),re=()=>{const{data:t,isLoading:r,error:s}=L(),{data:a,isLoading:o,error:i}=R();return e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{stats:t,isLoading:r}),e.jsx(I,{activities:a,isLoading:o,error:i}),e.jsx(P,{})]})};export{re as DashboardTab,re as default};
