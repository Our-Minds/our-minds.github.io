import{j as e}from"./ui-BG7jjlrC.js";import{d as H,u as M,s as v,F as A,a as P,G as U,H as V,J as B,K as G,N as O,k as T,I as E,O as $,Q as I,R as J,V as W,W as g,f as m,g as S,n as X,X as Y,E as Z}from"./index-CvhVXczW.js";import{u as ee,b as R,c as L}from"./query-C_TmXHuV.js";import{f as se}from"./format-Dmqbz6eD.js";import{T as ae,a as te,b as z,c as N,d as ne,e as j}from"./table-ItZkQoZb.js";import{S as F}from"./skeleton-6Y4fJ80v.js";import{r as C}from"./vendor-CsPsgsBv.js";import{T as re,a as le,b as q,c as D}from"./tabs-DdF9WTWQ.js";import"./router-J7O6VmFe.js";import"./utils-EL5wpLGY.js";import"./supabase-DoZrjKS4.js";import"./en-US-DcT3sm5m.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=H("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),oe=()=>{const{isAdmin:n}=M();return ee({queryKey:["all-consultants"],queryFn:async()=>{if(!n)throw new Error("Unauthorized");console.log("Fetching all consultants...");try{const{data:a,error:s}=await v.from("consultants").select(`
            id, 
            specialization, 
            created_at,
            approval_status,
            available
          `).order("created_at",{ascending:!1});if(s)throw console.error("Error fetching consultants:",s),s;if(console.log("Found all consultants:",a),!a||a.length===0)return console.log("No consultants found"),[];const r=a.map(i=>i.id),{data:d,error:o}=await v.from("users").select("id, name, email").in("id",r);if(o)throw console.error("Error fetching users:",o),o;console.log("Found users for consultants:",d);const p=a.map(i=>{const u=d?.find(h=>h.id===i.id);return{id:i.id,name:u?.name||"Unknown",email:u?.email||"no-email@example.com",specialization:i.specialization||[],submittedDate:se(new Date(i.created_at),"yyyy-MM-dd"),status:i.approval_status}});return console.log("Final all consultants data:",p),p}catch(a){throw console.error("Error in useAllConsultants:",a),a}},enabled:!!n,retry:2,retryDelay:1e3})},ce=()=>{const n=R(),{isAdmin:a}=M();return L({mutationFn:async s=>{if(!a)throw new Error("Unauthorized");console.log("Approving consultant:",s);const{error:r}=await v.from("consultants").update({approval_status:"approved",available:!0}).eq("id",s);if(r)throw console.error("Error approving consultant:",r),r;return{consultantId:s}},onSuccess:()=>{n.invalidateQueries({queryKey:["pending-consultants"]}),n.invalidateQueries({queryKey:["all-consultants"]}),n.invalidateQueries({queryKey:["approved-consultants"]}),A({title:"Consultant approved",description:"The consultant has been approved and is now available for sessions."})},onError:s=>{console.error("Failed to approve consultant:",s),A({title:"Failed to approve consultant",description:s.message||"An error occurred while approving the consultant.",variant:"destructive"})}})},de=()=>{const n=R(),{isAdmin:a}=M();return L({mutationFn:async s=>{if(!a)throw new Error("Unauthorized");console.log("Rejecting consultant:",s);const{error:r}=await v.from("consultants").update({approval_status:"rejected",available:!1}).eq("id",s);if(r)throw console.error("Error rejecting consultant:",r),r;return{consultantId:s}},onSuccess:()=>{n.invalidateQueries({queryKey:["pending-consultants"]}),n.invalidateQueries({queryKey:["all-consultants"]}),n.invalidateQueries({queryKey:["approved-consultants"]}),A({title:"Consultant rejected",description:"The consultant application has been rejected."})},onError:s=>{console.error("Failed to reject consultant:",s),A({title:"Failed to reject consultant",description:s.message||"An error occurred while rejecting the consultant.",variant:"destructive"})}})},ue=({children:n})=>{const[a,s]=C.useState(!1),[r,d]=C.useState(""),[o,p]=C.useState(""),[i,u]=C.useState(""),[h,f]=C.useState(""),[x,w]=C.useState(!1),{toast:y}=P(),t=R(),l=async c=>{c.preventDefault(),w(!0);try{const{data:b,error:k}=await v.auth.admin.createUser({email:o,password:"temp123!",email_confirm:!0});if(k)throw k;const _=b.user.id,{error:Q}=await v.from("users").insert({id:_,name:r,email:o,role:"consultant",profile_image:`https://ui-avatars.com/api/?name=${r.charAt(0)}&background=random&color=fff`});if(Q)throw Q;const{error:K}=await v.from("consultants").insert({id:_,specialization:[i],languages:["English"],location:h||"Remote",bio:"",paypal_email:o,approval_status:"approved",available:!0,hourly_rate:50});if(K)throw K;y({title:"Consultant added successfully",description:"The consultant has been added and approved automatically."}),d(""),p(""),u(""),f(""),s(!1),t.invalidateQueries({queryKey:["pending-consultants"]}),t.invalidateQueries({queryKey:["approved-consultants"]})}catch(b){console.error("Error adding consultant:",b),y({title:"Failed to add consultant",description:b.message||"An error occurred while adding the consultant.",variant:"destructive"})}finally{w(!1)}};return e.jsxs(U,{open:a,onOpenChange:s,children:[e.jsx(V,{asChild:!0,children:n}),e.jsxs(B,{className:"sm:max-w-md",children:[e.jsx(G,{children:e.jsx(O,{children:"Add New Consultant"})}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"name",children:"Full Name"}),e.jsx(E,{id:"name",value:r,onChange:c=>d(c.target.value),placeholder:"Enter consultant name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"email",children:"Email"}),e.jsx(E,{id:"email",type:"email",value:o,onChange:c=>p(c.target.value),placeholder:"Enter consultant email",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"specialization",children:"Specialization"}),e.jsxs($,{value:i,onValueChange:u,children:[e.jsx(I,{children:e.jsx(J,{placeholder:"Select specialization"})}),e.jsxs(W,{children:[e.jsx(g,{value:"General Mental Health",children:"General Mental Health"}),e.jsx(g,{value:"Anxiety",children:"Anxiety"}),e.jsx(g,{value:"Depression",children:"Depression"}),e.jsx(g,{value:"Trauma",children:"Trauma"}),e.jsx(g,{value:"Addiction",children:"Addiction"}),e.jsx(g,{value:"PTSD",children:"PTSD"}),e.jsx(g,{value:"Family Therapy",children:"Family Therapy"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"location",children:"Location"}),e.jsx(E,{id:"location",value:h,onChange:c=>f(c.target.value),placeholder:"Enter location (optional)"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:x,children:"Cancel"}),e.jsx(m,{type:"submit",disabled:x,children:x?"Adding...":"Add Consultant"})]})]})]})]})},we=()=>{const{data:n,isLoading:a,error:s,refetch:r}=oe(),d=ce(),o=de();console.log("ConsultantManagementTab - consultants:",n),console.log("ConsultantManagementTab - isLoading:",a),console.log("ConsultantManagementTab - error:",s);const p=t=>{console.log("Approving consultant:",t),d.mutate(t)},i=t=>{console.log("Rejecting consultant:",t),o.mutate(t)},u=()=>{console.log("Manually refreshing consultant data..."),r()},h=n?.filter(t=>t.status==="pending")||[],f=n?.filter(t=>t.status==="approved")||[],x=n?.filter(t=>t.status==="rejected")||[],w=t=>{switch(t){case"approved":return"default";case"pending":return"secondary";case"rejected":return"destructive";default:return"outline"}},y=t=>e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs(z,{children:[e.jsx(N,{children:"Name"}),e.jsx(N,{children:"Email"}),e.jsx(N,{children:"Specialization"}),e.jsx(N,{children:"Status"}),e.jsx(N,{children:"Submitted"}),e.jsx(N,{className:"text-right",children:"Actions"})]})}),e.jsx(ne,{children:t.length===0?e.jsx(z,{children:e.jsx(j,{colSpan:6,className:"text-center py-4",children:"No consultants found in this category"})}):t.map(l=>e.jsxs(z,{children:[e.jsx(j,{children:l.name}),e.jsx(j,{children:l.email}),e.jsx(j,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.specialization.slice(0,3).map((c,b)=>e.jsx(S,{variant:"outline",className:"text-xs",children:c},b)),l.specialization.length>3&&e.jsxs(S,{variant:"outline",className:"text-xs",children:["+",l.specialization.length-3," more"]})]})}),e.jsx(j,{children:e.jsx(S,{variant:w(l.status),children:l.status.charAt(0).toUpperCase()+l.status.slice(1)})}),e.jsx(j,{children:l.submittedDate}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[l.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>p(l.id),disabled:d.isPending,className:"text-green-600 hover:bg-green-50",title:"Approve consultant",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>i(l.id),disabled:o.isPending,className:"text-red-600 hover:bg-red-50",title:"Reject consultant",children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx(m,{variant:"ghost",size:"icon",title:"View details",children:e.jsx(Z,{className:"h-4 w-4"})})]})})]},l.id))})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Consultant Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:u,disabled:a,children:[e.jsx(ie,{className:`h-4 w-4 mr-2 ${a?"animate-spin":""}`}),"Refresh"]}),e.jsx(ue,{children:e.jsx(m,{size:"sm",children:"Add Consultant"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.length}),e.jsx("div",{className:"text-sm text-blue-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.length}),e.jsx("div",{className:"text-sm text-green-600",children:"Approved"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.length}),e.jsx("div",{className:"text-sm text-red-600",children:"Rejected"})]})]}),e.jsx("div",{className:"rounded-md border",children:a?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(F,{className:"h-12 w-full"}),e.jsx(F,{className:"h-12 w-full"}),e.jsx(F,{className:"h-12 w-full"})]}):s?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-600 font-medium",children:"Failed to load consultants"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.message}),e.jsx(m,{onClick:u,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]}):e.jsxs(re,{defaultValue:"pending",className:"w-full",children:[e.jsxs(le,{className:"grid w-full grid-cols-3",children:[e.jsxs(q,{value:"pending",children:["Pending (",h.length,")"]}),e.jsxs(q,{value:"approved",children:["Approved (",f.length,")"]}),e.jsxs(q,{value:"rejected",children:["Rejected (",x.length,")"]})]}),e.jsx(D,{value:"pending",className:"mt-4",children:y(h)}),e.jsx(D,{value:"approved",className:"mt-4",children:y(f)}),e.jsx(D,{value:"rejected",className:"mt-4",children:y(x)})]})})]})};export{we as ConsultantManagementTab,we as default};
