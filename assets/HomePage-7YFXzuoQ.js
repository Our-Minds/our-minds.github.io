import{j as e}from"./ui-BG7jjlrC.js";import{r as f}from"./vendor-CsPsgsBv.js";import{L as b,u as T}from"./router-J7O6VmFe.js";import{I as E,u as M,a as S,C as _,M as I,b as C,c as P,L as F,B as D,s as H}from"./index-CvhVXczW.js";import{A as U,a as W,b as z}from"./avatar-BFIKPfdM.js";import{S as t}from"./skeleton-6Y4fJ80v.js";import{T as w,f as L}from"./formatDistanceToNow-CT3n5jHP.js";import{S as O}from"./star-C7tKwoGQ.js";import{C as R}from"./clock-CFGbNuaY.js";import{U as A}from"./user-BoqZ4jN3.js";import{S as $}from"./search-BaabGXuh.js";import{f as q}from"./chatUtils-Ctqdd6qY.js";import"./query-C_TmXHuV.js";import"./utils-EL5wpLGY.js";import"./supabase-DoZrjKS4.js";import"./constructNow-CbkWqtaZ.js";import"./en-US-DcT3sm5m.js";function N({stories:a,isLoading:g}){const s=a.find(d=>d.is_featured)||a[0];if(g)return e.jsxs("div",{className:"relative overflow-hidden rounded-3xl shadow-2xl h-full bg-gradient-to-br from-gray-50 to-gray-100 dark:from-[#161b22] dark:to-[#21262d]",children:[e.jsxs("div",{className:"relative h-3/5",children:[e.jsx(t,{className:"w-full h-full rounded-t-3xl"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#025803]/80 via-[#025803]/50 to-transparent"})]}),e.jsxs("div",{className:"p-4 lg:p-6 h-2/5 bg-white dark:bg-[#161b22]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(t,{className:"h-6 w-6 rounded-full"}),e.jsx(t,{className:"h-5 w-32"})]}),e.jsx(t,{className:"h-6 w-full mb-2"}),e.jsx(t,{className:"h-4 w-full mb-2"}),e.jsx(t,{className:"h-4 w-3/4 mb-4"}),e.jsxs("div",{className:"flex items-center mt-auto",children:[e.jsx(t,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"ml-3",children:[e.jsx(t,{className:"h-4 w-24"}),e.jsx(t,{className:"h-3 w-16 mt-1"})]})]})]})]});if(!s)return e.jsx("div",{className:"rounded-3xl overflow-hidden shadow-2xl bg-gradient-to-br from-gray-50 to-gray-100 dark:from-[#161b22] dark:to-[#21262d] h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 dark:bg-[#30363d] rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(w,{className:"w-8 h-8 text-gray-600 dark:text-gray-400"})}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 font-medium",children:"No featured stories available"})]})});const m=(d,i)=>d?d.length<=i?d:d.slice(0,d.lastIndexOf(" ",i))+"...":"",n=Math.ceil(s.content.split(" ").length/200);return e.jsx(b,{to:`/story/${s.id}`,className:"block h-full",children:e.jsxs("div",{className:"relative overflow-hidden rounded-3xl shadow-2xl h-full bg-white dark:bg-[#161b22]",children:[e.jsx("div",{className:"absolute top-4 left-4 z-20",children:e.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-[#025803] to-[#037004] text-white px-4 py-2 rounded-full shadow-lg backdrop-blur-sm",children:[e.jsx(O,{className:"w-4 h-4 fill-current"}),e.jsx("span",{className:"text-sm font-bold",children:"Featured"})]})}),e.jsxs("div",{className:"relative h-3/5 overflow-hidden",children:[e.jsx("img",{src:s.cover_image,alt:s.title,className:"w-full h-full object-cover",onError:d=>{d.target.src="/placeholder.svg"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#025803]/90 via-[#025803]/40 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 lg:p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-white text-xs font-medium",children:s.tags[0]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1.5",children:[e.jsx(R,{className:"w-3 h-3 text-white"}),e.jsxs("span",{className:"text-white text-xs font-medium",children:[n," min read"]})]})]}),e.jsx("h1",{className:"text-white text-xl lg:text-2xl xl:text-3xl font-bold leading-tight mb-2 line-clamp-2",children:s.title})]})]}),e.jsxs("div",{className:"h-2/5 bg-gradient-to-br from-white to-gray-50 dark:from-[#161b22] dark:to-[#21262d] p-4 lg:p-6 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-[#025803] to-[#037004] rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-3 h-3 text-white"})}),e.jsx("h2",{className:"text-[#025803] text-lg font-bold",children:"Top Story"})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm lg:text-base leading-relaxed line-clamp-5 mb-4",children:m(s.content,280)})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-[#30363d]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(U,{className:"h-10 w-10 ring-2 ring-gray-200 dark:ring-[#30363d] shadow-md",children:[e.jsx(W,{src:s.authorImage}),e.jsx(z,{className:"bg-gray-100 dark:bg-[#21262d] text-gray-700 dark:text-gray-300",children:(s.authorName||"Anonymous").charAt(0)})]}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-[#025803] border-2 border-white dark:border-[#161b22] rounded-full flex items-center justify-center",children:e.jsx(A,{className:"w-2 h-2 text-white"})})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100 text-sm truncate",children:s.authorName||"Anonymous"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:"Author"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:L(new Date(s.published_at),{addSuffix:!0})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[#025803] text-sm font-medium",children:"Read Story"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Trending #1"})]})]})]})]})})}function B({searchQuery:a,setSearchQuery:g,resultCount:s}){return e.jsxs("div",{className:"sticky top-0 z-[90] p-3 border-b border-gray-200 dark:border-[#3a3a3a] bg-white dark:bg-[#2a2a2a] flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-3.5 h-3.5"}),e.jsx(E,{type:"text",placeholder:"Search by title, content, tags...",value:a,onChange:m=>g(m.target.value),className:"pl-8 h-8 text-sm bg-gray-50 dark:bg-[#3a3a3a] border-gray-200 dark:border-[#4a4a4a] focus:bg-white dark:focus:bg-[#2a2a2a] focus:border-[#025803] dark:focus:border-[#037004] transition-colors text-gray-900 dark:text-gray-100"})]}),a&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Found ",s," result",s!==1?"s":"",' for "',a,'"']})]})}function Y({story:a,index:g,isSearching:s}){const m=T(),{user:n,isAuthenticated:d}=M(),{toast:i}=S(),x=async r=>{if(!d){i({title:"Authentication required",description:"Please login to chat with authors",variant:"destructive"}),m("/login");return}if(n?.id===r){i({title:"Cannot chat with yourself",description:"You cannot start a chat with yourself",variant:"destructive"});return}try{const h=await q(r,n.id);m(`/chat/${h.id}`)}catch(h){console.error("Error starting chat:",h),i({title:"Failed to start chat",description:h.message||"An error occurred",variant:"destructive"})}},u=(r,h=120)=>{if(!r)return"";const j=r.replace(/<[^>]*>/g,"");return j.length>h?j.substring(0,h)+"...":j},o=r=>({mental:"bg-blue-500",control:"bg-purple-500",drugs:"bg-red-500",life:"bg-green-500",anxiety:"bg-orange-500",depression:"bg-indigo-500"})[r]||"bg-gray-500",c=r=>{const j=r.replace(/<[^>]*>/g,"").split(/\s+/).length;return`${Math.ceil(j/200)} min read`},p=a.authorName||a.author?.name||"Anonymous",y=a.authorImage||a.author?.profile_image||null,l=a.author_id,k=u(a.content);return c(a.content),e.jsx("div",{className:"relative",children:e.jsx(b,{to:`/story/${a.id}`,className:"block",children:e.jsxs(_,{className:"overflow-hidden border border-border bg-card rounded-lg",children:[e.jsx("div",{className:"relative w-full aspect-[2/1] overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${a.cover_image||"/placeholder.svg"})`}})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:a.tags.map((r,h)=>e.jsx("span",{className:`inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold text-white ${o(a.tag_type)}`,children:r},h))}),e.jsx("h3",{className:"text-xl font-bold text-foreground leading-tight line-clamp-2",children:a.title}),k&&e.jsx("p",{className:"text-muted-foreground leading-relaxed line-clamp-3 text-sm",children:k}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:e.jsx("span",{children:L(new Date(a.published_at),{addSuffix:!0})})})]}),a.is_anonymous?e.jsx("div",{className:"flex items-center justify-center pt-4 border-t border-border",children:e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Message Shared Anonymously"})}):e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:y||"/placeholder.svg",alt:p,className:"w-10 h-10 rounded-full object-cover ring-2 ring-border",onError:r=>{r.target.src="/placeholder.svg"}}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 border-2 border-card rounded-full"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:p}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Author"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),m(`/profile/${l}`)},className:"p-2 rounded-full hover:bg-accent",title:"View Profile",children:e.jsx(A,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),x(l)},className:"p-2 rounded-full hover:bg-accent",title:`Chat with ${p.split(" ")[0]}`,children:e.jsx(I,{className:"w-4 h-4 text-primary"})})]})]})]})})]})})})}function V({searchQuery:a}){return e.jsxs("div",{className:"text-center py-16",children:[e.jsxs("div",{className:"relative mx-auto mb-6 w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-[#21262d] dark:to-[#161b22] rounded-2xl"}),e.jsx("div",{className:"relative flex items-center justify-center w-full h-full",children:a?e.jsx($,{className:"w-10 h-10 text-gray-400 dark:text-gray-500"}):e.jsx(w,{className:"w-10 h-10 text-gray-400 dark:text-gray-500"})})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:a?"No stories found":"No stories available"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-sm mx-auto leading-relaxed",children:a?`No stories match your search for "${a}". Try different keywords or tags.`:"Check back later for trending content from our amazing community of writers"})]})}function G(){return e.jsxs("div",{className:"bg-gray-100 dark:bg-[#212121] rounded-3xl border border-gray-200 dark:border-[#3a3a3a] shadow-sm h-full overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-[#3a3a3a] bg-white dark:bg-[#2a2a2a]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-[#025803]/10 to-[#025803]/20 dark:from-[#025803]/20 dark:to-[#025803]/30 rounded-xl",children:e.jsx(w,{className:"w-5 h-5 text-[#025803] dark:text-[#037004]"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{className:"h-6 w-32 bg-gray-200 dark:bg-[#3a3a3a]"}),e.jsx(t,{className:"h-3 w-48 bg-gray-200 dark:bg-[#3a3a3a]"})]})]}),e.jsx(t,{className:"h-10 w-full mt-4 rounded-lg bg-gray-200 dark:bg-[#3a3a3a]"})]}),e.jsx("div",{className:"p-6 space-y-6 overflow-y-auto max-h-[calc(100vh-16rem)]",children:[1,2,3,4].map(a=>e.jsxs(_,{className:"overflow-hidden border border-gray-200 dark:border-[#3a3a3a] shadow-md bg-white dark:bg-[#2a2a2a] rounded-2xl",children:[e.jsx(t,{className:"w-full h-48 rounded-t-2xl bg-gray-200 dark:bg-[#3a3a3a]"}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(t,{className:"h-5 w-20 rounded-full bg-gray-200 dark:bg-[#3a3a3a]"}),e.jsx(t,{className:"h-6 w-full bg-gray-200 dark:bg-[#3a3a3a]"}),e.jsx(t,{className:"h-4 w-5/6 bg-gray-200 dark:bg-[#3a3a3a]"}),e.jsx(t,{className:"h-4 w-4/6 bg-gray-200 dark:bg-[#3a3a3a]"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t,{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-[#3a3a3a]"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{className:"w-24 h-4 bg-gray-200 dark:bg-[#3a3a3a]"}),e.jsx(t,{className:"w-16 h-3 bg-gray-200 dark:bg-[#3a3a3a]"})]})]}),e.jsx(t,{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-[#3a3a3a]"})]})]})})]},a))})]})}function v({stories:a,isLoading:g}){const[s,m]=f.useState(""),n=C(),d=f.useMemo(()=>{if(!s.trim())return a;const i=s.toLowerCase();return a.filter(x=>x.title.toLowerCase().includes(i)||x.content.toLowerCase().includes(i)||x.tags.some(u=>u.toLowerCase().includes(i))||x.tag_type.toLowerCase().includes(i)||x.authorName&&x.authorName.toLowerCase().includes(i))},[a,s]);return g?e.jsx(G,{}):e.jsxs("div",{className:`
      bg-gray-100 dark:bg-[#212121] border border-gray-200 dark:border-[#3a3a3a]
      ${n?"rounded-t-3xl border-b-0 shadow-sm min-h-screen":"h-full"} 
      flex flex-col
    `,children:[e.jsx(B,{searchQuery:s,setSearchQuery:m,resultCount:d.length}),e.jsx("div",{className:`
        flex-1 overflow-y-auto scrollbar-hide
        ${n?"p-4 pb-24":"p-6"} 
      `,children:d.length>0?e.jsx("div",{className:"space-y-4 lg:space-y-6",children:d.map((i,x)=>e.jsx(Y,{story:i,index:x,isSearching:!!s},i.id))}):e.jsx(V,{searchQuery:s})})]})}function he(){const[a,g]=f.useState(!1),[s,m]=f.useState(!0),[n,d]=f.useState([]),{toast:i}=S(),x=C(),u=P("stories");return f.useEffect(()=>{if(!u){m(!1);return}(async()=>{try{m(!0);const{data:c,error:p}=await H.from("stories_with_authors").select("*").order("published_at",{ascending:!1});if(p)throw p;if(c){const y=c.map(l=>({id:l.id,title:l.title,snippet:l.snippet,content:l.content,cover_image:l.cover_image||"/placeholder.svg",tags:l.tags||[],tag_type:l.tag_type||"mental",author_id:l.author_id,is_featured:l.is_featured||!1,is_anonymous:l.is_anonymous||!1,published_at:l.published_at,created_at:l.created_at,updated_at:l.updated_at,authorName:l.author_name,authorImage:l.author_image,author:{name:l.author_name||"Anonymous",profile_image:l.author_image}}));d(y)}}catch(c){console.error("Error fetching stories:",c),i({title:"Failed to load stories",description:c.message||"Could not retrieve stories from the database",variant:"destructive"})}finally{m(!1)}})()},[i,u]),f.useEffect(()=>{const o=()=>{g(window.scrollY>300)};return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]),e.jsxs(F,{showSidebar:!0,children:[e.jsx("div",{className:"w-full h-full bg-white dark:bg-[#212121]",children:u?x?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"w-full border-b border-gray-200 dark:border-[#3a3a3a]",children:e.jsx("div",{className:"p-4",children:s?e.jsx(N,{stories:n,isLoading:!0}):e.jsx(N,{stories:n.map(o=>({...o,linkWrapper:c=>e.jsx(b,{to:`/story/${o.id}`,children:c})})),isLoading:!1})})}),e.jsx("div",{className:"flex-1 pb-20",children:s?e.jsx(v,{stories:n,isLoading:!0}):e.jsx(v,{stories:n.map(o=>({...o,linkWrapper:c=>e.jsx(b,{to:`/story/${o.id}`,children:c})})),isLoading:!1})})]}):e.jsxs("div",{className:"flex h-[calc(100vh-3.5rem)] w-full",children:[e.jsx("div",{className:"w-1/2 h-full border-r-2 border-gray-300 dark:border-[#3a3a3a] overflow-hidden",children:e.jsx("div",{className:"h-full p-6 overflow-y-auto scrollbar-hide bg-white dark:bg-[#212121]",children:s?e.jsx(N,{stories:n,isLoading:!0}):e.jsx(N,{stories:n.map(o=>({...o,linkWrapper:c=>e.jsx(b,{to:`/story/${o.id}`,children:c})})),isLoading:!1})})}),e.jsx("div",{className:"w-1/2 h-full overflow-hidden",children:s?e.jsx(v,{stories:n,isLoading:!0}):e.jsx(v,{stories:n.map(o=>({...o,linkWrapper:c=>e.jsx(b,{to:`/story/${o.id}`,children:c})})),isLoading:!1})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center p-8 max-w-md mx-auto",children:[e.jsx(D,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Stories Currently Unavailable"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"The stories feature is temporarily disabled. Please check back later or contact support for more information."}),e.jsx(b,{to:"/about",className:"inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground px-4 py-2 text-sm font-medium transition-colors hover:bg-primary/90",children:"Learn More About Us"})]})})}),a]})}export{he as HomePage,he as default};
