import{j as e,a as Se,u as _e,n as Ee,P as de,d as le,M as ke,N as Pe}from"./ui-BG7jjlrC.js";import{d as te,a as G,u as O,f as E,X as ue,I as R,P as Te,g as q,s as w,C as P,h as F,i as I,j as T,k as z,l as X,m as De,e as oe,n as Fe,o as me,b as Ie,p as Ae,B as he,q as re,L as ce}from"./index-CvhVXczW.js";import{T as fe,a as xe,b as Y,c as B}from"./tabs-DdF9WTWQ.js";import{r as d}from"./vendor-CsPsgsBv.js";import{A as Me,a as Le,b as Ue}from"./avatar-BFIKPfdM.js";import{T as pe,a as ge,b as J,c as L,d as je,e as M}from"./table-ItZkQoZb.js";import{D as Re}from"./dollar-sign-GZkvHI9w.js";import{S as qe}from"./switch-CU4KXutq.js";import{C as ee}from"./clock-CFGbNuaY.js";import{t as se}from"./en-US-DcT3sm5m.js";import{p as K}from"./parseISO-G0xhW6v5.js";import{f as ie}from"./format-Dmqbz6eD.js";import{L as $e}from"./router-J7O6VmFe.js";import{S as ze}from"./square-pen-PyxYW7o-.js";import{T as Ye}from"./trash-2-ylsRDHL7.js";import"./query-C_TmXHuV.js";import"./utils-EL5wpLGY.js";import"./supabase-DoZrjKS4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=te("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=te("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=te("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=te("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);function We(s,r){const a=se(s),i=se(r);return a.getTime()>i.getTime()}function Ke(s,r){const a=se(s),i=se(r);return+a<+i}function Xe({currentImage:s,onImageChange:r,size:a="md"}){const{toast:i}=G(),{user:u}=O(),n=d.useRef(null),[j,v]=d.useState(null),[f,o]=d.useState(!1),b={sm:"h-20 w-20",md:"h-32 w-32",lg:"h-40 w-40"},x="https://raw.githubusercontent.com/Our-Minds/our-minds.github.io/refs/heads/main/public/assets/default.png",l=async t=>{const m=t.target.files?.[0];if(!m)return;if(!m.type.startsWith("image/")){i({title:"Invalid file type",description:"Please upload an image file",variant:"destructive"});return}if(m.size>5*1024*1024){i({title:"File too large",description:"Image must be less than 5MB",variant:"destructive"});return}const N=new FileReader;N.onload=()=>{const g=N.result;v(g)},N.readAsDataURL(m);try{o(!0),await r(m),i({title:"Image uploaded",description:"Your profile image has been updated successfully."})}catch(g){console.error("Error uploading image:",g),i({title:"Upload failed",description:g.message||"Could not upload your image. Please try again.",variant:"destructive"}),v(null)}finally{o(!1)}},p=()=>{n.current&&n.current.click()},C=async()=>{try{o(!0),v(null),n.current&&(n.current.value=""),await r(null),i({title:"Image removed",description:"Your profile image has been removed."})}catch(t){i({title:"Error removing image",description:t.message||"Could not remove your profile image.",variant:"destructive"})}finally{o(!1)}},S=j||s||x,y=u?.email?.[0].toUpperCase()||"U";return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Me,{className:`${b[a]} border-2 border-gray-200`,children:[e.jsx(Le,{src:S,onError:t=>{t.target.src=x}}),e.jsx(Ue,{className:"text-3xl",children:y})]}),e.jsxs("div",{className:"absolute -bottom-2 -right-2 flex gap-1",children:[e.jsxs(E,{type:"button",size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full shadow",onClick:p,disabled:f,children:[e.jsx(Be,{size:16}),e.jsx("span",{className:"sr-only",children:"Upload image"})]}),S&&e.jsxs(E,{type:"button",size:"icon",variant:"destructive",className:"h-8 w-8 rounded-full shadow",onClick:C,disabled:f,children:[e.jsx(ue,{size:16}),e.jsx("span",{className:"sr-only",children:"Remove image"})]})]})]}),e.jsx("input",{type:"file",className:"hidden",ref:n,onChange:l,accept:"image/*"})]})}function Ge({tags:s,onChange:r,maxTags:a=6}){const{toast:i}=G(),[u,n]=d.useState(""),j=()=>{const o=u.trim();if(o){if(s.includes(o)){i({title:"Tag already exists",description:"This tag has already been added.",variant:"destructive"});return}if(s.length>=a){i({title:"Maximum tags reached",description:`You can only add up to ${a} tags.`,variant:"destructive"});return}r([...s,o]),n("")}},v=o=>{o.key==="Enter"&&(o.preventDefault(),j())},f=o=>{r(s.filter(b=>b!==o))};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{value:u,onChange:o=>n(o.target.value),onKeyDown:v,placeholder:"Add a specialization tag...",className:"flex-1",disabled:s.length>=a}),e.jsxs(E,{type:"button",onClick:j,disabled:!u.trim()||s.length>=a,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"})," Add"]})]}),s.length>=a&&e.jsxs("p",{className:"text-amber-600 text-sm",children:["Maximum of ",a," tags reached"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[s.map((o,b)=>e.jsxs(q,{variant:"secondary",className:"px-2 py-1 text-sm",children:[o,e.jsxs("button",{type:"button",onClick:()=>f(o),className:"ml-1 text-gray-500 hover:text-gray-700 focus:outline-none",children:[e.jsx(ue,{size:14}),e.jsxs("span",{className:"sr-only",children:["Remove ",o]})]})]},o)),s.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"No tags added yet"})]})]})}async function Qe(s,r){if(!r)return null;try{const a=r.split("/"),i=a[a.length-1];if(r.includes(`/${s}/`))return r;const{data:u,error:n}=await w.storage.from("profile_images").download(i);if(n)return console.error("Error downloading old profile image:",n),r;const j=`${s}/${i}`,{error:v}=await w.storage.from("profile_images").upload(j,u,{cacheControl:"3600",upsert:!0});if(v)return console.error("Error uploading to new path:",v),r;const{data:f}=w.storage.from("profile_images").getPublicUrl(j),{error:o}=await w.from("users").update({profile_image:f.publicUrl}).eq("id",s);return o&&console.error("Error updating user profile:",o),f.publicUrl}catch(a){return console.error("Profile image migration failed:",a),r}}function Ze({isConsultant:s=!1,isAdmin:r=!1}){const{profile:a,user:i,refreshProfile:u}=O(),{toast:n}=G(),[j,v]=d.useState(!1),[f,o]=d.useState(a?.profileImage||""),[b,x]=d.useState(a?.name||""),[l,p]=d.useState(a?.bio||""),[C,S]=d.useState(a?.specialization||["Anxiety","Depression","Stress Management"]),[y,t]=d.useState("Remote"),[m,N]=d.useState(["English"]),[g,k]=d.useState(50);d.useEffect(()=>{a&&(x(a.name||""),o(a.profileImage||""),p(a.bio||""),S(a.specialization||["Anxiety","Depression","Stress Management"]),s&&V())},[a,s]);const V=async()=>{if(i)try{const{data:h,error:_}=await w.from("consultants").select("location, languages, hourly_rate").eq("id",i.id).single();if(_){console.log("No consultant record found, using defaults");return}h&&(t(h.location||"Remote"),N(h.languages||["English"]),k(h.hourly_rate||50))}catch(h){console.error("Error fetching consultant details:",h)}};d.useEffect(()=>{(async()=>{if(i&&a?.profileImage)try{if(!a.profileImage.includes(`/${i.id}/`)){console.log("Attempting to migrate profile image");const _=await Qe(i.id,a.profileImage);_&&_!==a.profileImage&&(o(_),n({title:"Profile image updated",description:"Your profile image has been migrated to a new format."}))}}catch(_){console.error("Error migrating profile image:",_)}})()},[i,a?.profileImage,n]);const Q=async h=>{if(!i)throw new Error("User not authenticated");if(h===null){o("");return}if(typeof h=="string"){o(h);return}try{const _=h.name.split(".").pop(),D=`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${_}`,W=`${i.id}/${D}`,{error:U,data:Z}=await w.storage.from("profile_images").upload(W,h,{cacheControl:"3600",upsert:!0});if(U)throw U;const{data:A}=w.storage.from("profile_images").getPublicUrl(W);o(A.publicUrl)}catch(_){throw console.error("Error uploading profile image:",_),new Error(_.message||"Failed to upload image")}},c=async()=>{if(!i||!a){n({title:"Not authenticated",description:"You need to be logged in to update your profile.",variant:"destructive"});return}v(!0);try{const{error:h}=await w.from("users").update({name:b,profile_image:f}).eq("id",i.id);if(h)throw h;if(s){const{data:_}=await w.from("consultants").select("id").eq("id",i.id).single();if(_){const{error:D}=await w.from("consultants").update({specialization:C,bio:l,location:y,languages:m,hourly_rate:g}).eq("id",i.id);if(D)throw D}else{const{error:D}=await w.from("consultants").insert({id:i.id,specialization:C,bio:l,location:y,languages:m,hourly_rate:g,paypal_email:""});if(D)throw D}}u&&await u(),n({title:"Profile updated",description:"Your profile changes have been saved."})}catch(h){n({title:"Update failed",description:h.message||"There was an error saving your profile. Please try again.",variant:"destructive"})}finally{v(!1)}};return a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsx(F,{children:e.jsx(I,{children:"Profile Picture"})}),e.jsx(T,{className:"flex justify-center",children:e.jsx(Xe,{currentImage:f,onImageChange:Q,size:"lg"})})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsx(I,{children:"Personal Information"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"name",children:"Full Name"}),e.jsx(R,{id:"name",value:b,onChange:h=>x(h.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"email",children:"Email"}),e.jsx(R,{id:"email",value:a.email||"",type:"email",disabled:!0})]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"role",children:"Role"}),e.jsx(R,{id:"role",value:"Administrator",disabled:!0})]})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Consultant Details"}),e.jsx(X,{children:"Update your location, languages, and hourly rate."})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"location",children:"Location"}),e.jsx(R,{id:"location",value:y,onChange:h=>t(h.target.value),placeholder:"e.g., Remote, New York, London"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"languages",children:"Languages (comma-separated)"}),e.jsx(R,{id:"languages",value:m.join(", "),onChange:h=>N(h.target.value.split(",").map(_=>_.trim()).filter(Boolean)),placeholder:"e.g., English, Spanish, French"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"hourly-rate",children:"Hourly Rate ($)"}),e.jsx(R,{id:"hourly-rate",type:"number",value:g,onChange:h=>k(Number(h.target.value)),min:"0",step:"5"})]})]})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Consultant Specializations"}),e.jsx(X,{children:"Add up to 6 specialization tags. The first 3 tags will be displayed on your public profile."})]}),e.jsx(T,{children:e.jsx(Ge,{tags:C,onChange:S,maxTags:6})})]})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Bio"}),e.jsx(X,{children:"Tell others a little about yourself."})]}),e.jsx(T,{children:e.jsx("textarea",{className:"flex min-h-[120px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",placeholder:"Write a short bio...",value:l,onChange:h=>p(h.target.value)})})]}),e.jsx("div",{className:"flex justify-end pt-4 pb-8 sm:pb-4",children:e.jsx(E,{onClick:c,disabled:j,className:"w-full sm:w-auto",children:j?"Saving...":"Save Changes"})})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:"Loading profile..."})}function Je(){const{toast:s}=G(),{user:r,profile:a}=O(),[i,u]=d.useState([]),[n,j]=d.useState(""),[v,f]=d.useState(!1),[o,b]=d.useState(""),[x,l]=d.useState(!1),[p,C]=d.useState(0),[S,y]=d.useState(0),[t,m]=d.useState(0);d.useEffect(()=>{r&&(N(),g())},[r]);const N=async()=>{if(r)try{const{data:c,error:h}=await w.from("consultants").select("paypal_email").eq("id",r.id).single();if(h)throw h;c&&(j(c.paypal_email||""),b(c.paypal_email||""))}catch(c){console.error("Error fetching consultant data:",c),s({title:"Error loading consultant data",description:c.message,variant:"destructive"})}},g=async()=>{if(r){l(!0);try{const{data:c,error:h}=await w.from("transactions").select("*").eq("consultant_id",r.id).order("created_at",{ascending:!1});if(h)throw h;const _=await Promise.all((c||[]).map(async D=>{let W="Unknown Client";if(D.session_id)try{const{data:U}=await w.from("sessions").select("user_id").eq("id",D.session_id).single();if(U){const{data:Z}=await w.from("users").select("name").eq("id",U.user_id).single();Z&&(W=Z.name)}}catch(U){console.error("Error fetching user name:",U)}return{...D,user_name:W}}));u(_),k(_)}catch(c){console.error("Error fetching transactions:",c),s({title:"Error loading transactions",description:c.message,variant:"destructive"})}finally{l(!1)}}},k=c=>{const h=c.filter(A=>A.status==="completed"),_=h.reduce((A,$)=>A+$.amount,0),D=new Date().getMonth(),W=new Date().getFullYear(),U=h.filter(A=>{const $=new Date(A.created_at);return $.getMonth()===D&&$.getFullYear()===W}).reduce((A,$)=>A+$.amount,0),Z=c.filter(A=>A.status==="pending").reduce((A,$)=>A+$.amount,0);C(_),y(U),m(Z)},V=async()=>{if(r){l(!0);try{const{error:c}=await w.from("consultants").update({paypal_email:o}).eq("id",r.id);if(c)throw c;j(o),f(!1),s({title:"PayPal email updated",description:"Your payment information has been updated successfully."})}catch(c){console.error("Error updating PayPal email:",c),s({title:"Error updating PayPal email",description:c.message,variant:"destructive"})}finally{l(!1)}}},Q=c=>new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(P,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"Total Earnings"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Re,{className:"mr-2 h-4 w-4 text-mental-green-500"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",p.toFixed(2)]})]})})]}),e.jsxs(P,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"This Month"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{className:"mr-2 h-4 w-4 text-mental-green-500"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",S.toFixed(2)]})]})})]}),e.jsxs(P,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"Pending Payout"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4 text-mental-green-500"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",t.toFixed(2)]})]})})]})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Payment Information"}),e.jsx(X,{children:"Update your payment details and preferences."})]}),e.jsx(T,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(z,{htmlFor:"paypal-email",children:"PayPal Email"}),v?e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(R,{id:"paypal-email",value:o,onChange:c=>b(c.target.value),placeholder:"your-paypal@example.com",className:"flex-1",disabled:x}),e.jsx(E,{onClick:V,disabled:x,children:x?"Saving...":"Save"}),e.jsx(E,{variant:"outline",onClick:()=>{f(!1),b(n)},disabled:x,children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(R,{id:"paypal-email",value:n||"No PayPal email set",disabled:!0,className:"bg-muted"}),e.jsx(E,{onClick:()=>f(!0),disabled:x,children:"Change"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"All payments will be sent to this PayPal email address."})]})})})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Transaction History"}),e.jsx(X,{children:"Your recent payment history and session details."})]}),e.jsx(T,{children:x?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),e.jsx("p",{children:"Loading transactions..."})]})}):i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No transactions yet. Complete sessions to see your earnings here."})}):e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(J,{children:[e.jsx(L,{children:"Date"}),e.jsx(L,{children:"Client"}),e.jsx(L,{children:"Description"}),e.jsx(L,{className:"text-right",children:"Amount"}),e.jsx(L,{children:"Status"})]})}),e.jsx(je,{children:i.map(c=>e.jsxs(J,{children:[e.jsx(M,{children:Q(c.created_at)}),e.jsx(M,{children:c.user_name||"Unknown Client"}),e.jsx(M,{children:c.description}),e.jsxs(M,{className:"text-right",children:["$",c.amount.toFixed(2)]}),e.jsx(M,{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium 
                        ${c.status==="completed"?"bg-green-100 text-green-800":c.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:c.status.charAt(0).toUpperCase()+c.status.slice(1)})})]},c.id))})]})})]})]})}var ne="Checkbox",[es,Ds]=Se(ne),[ss,ts]=es(ne),ye=d.forwardRef((s,r)=>{const{__scopeCheckbox:a,name:i,checked:u,defaultChecked:n,required:j,disabled:v,value:f="on",onCheckedChange:o,form:b,...x}=s,[l,p]=d.useState(null),C=_e(r,g=>p(g)),S=d.useRef(!1),y=l?b||!!l.closest("form"):!0,[t=!1,m]=Ee({prop:u,defaultProp:n,onChange:o}),N=d.useRef(t);return d.useEffect(()=>{const g=l?.form;if(g){const k=()=>m(N.current);return g.addEventListener("reset",k),()=>g.removeEventListener("reset",k)}},[l,m]),e.jsxs(ss,{scope:a,state:t,disabled:v,children:[e.jsx(de.button,{type:"button",role:"checkbox","aria-checked":H(t)?"mixed":t,"aria-required":j,"data-state":Ne(t),"data-disabled":v?"":void 0,disabled:v,value:f,...x,ref:C,onKeyDown:le(s.onKeyDown,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:le(s.onClick,g=>{m(k=>H(k)?!0:!k),y&&(S.current=g.isPropagationStopped(),S.current||g.stopPropagation())})}),y&&e.jsx(as,{control:l,bubbles:!S.current,name:i,value:f,checked:t,required:j,disabled:v,form:b,style:{transform:"translateX(-100%)"},defaultChecked:H(n)?!1:n})]})});ye.displayName=ne;var ve="CheckboxIndicator",be=d.forwardRef((s,r)=>{const{__scopeCheckbox:a,forceMount:i,...u}=s,n=ts(ve,a);return e.jsx(ke,{present:i||H(n.state)||n.state===!0,children:e.jsx(de.span,{"data-state":Ne(n.state),"data-disabled":n.disabled?"":void 0,...u,ref:r,style:{pointerEvents:"none",...s.style}})})});be.displayName=ve;var as=s=>{const{control:r,checked:a,bubbles:i=!0,defaultChecked:u,...n}=s,j=d.useRef(null),v=De(a),f=Pe(r);d.useEffect(()=>{const b=j.current,x=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(x,"checked").set;if(v!==a&&p){const C=new Event("click",{bubbles:i});b.indeterminate=H(a),p.call(b,H(a)?!1:a),b.dispatchEvent(C)}},[v,a,i]);const o=d.useRef(H(a)?!1:a);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:u??o.current,...n,tabIndex:-1,ref:j,style:{...s.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function H(s){return s==="indeterminate"}function Ne(s){return H(s)?"indeterminate":s?"checked":"unchecked"}var we=ye,rs=be;const Ce=d.forwardRef(({className:s,...r},a)=>e.jsx(we,{ref:a,className:oe("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:e.jsx(rs,{className:oe("flex items-center justify-center text-current"),children:e.jsx(Fe,{className:"h-4 w-4"})})}));Ce.displayName=we.displayName;const ae=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],is=["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"];function ns(){const{user:s}=O(),{toast:r}=G(),[a,i]=d.useState(!1),[u,n]=d.useState(!1),[j,v]=d.useState(ae.map(l=>({day:l,slots:[]})));d.useEffect(()=>{s&&f()},[s]);const f=async()=>{if(s){i(!0);try{const{data:l,error:p}=await w.from("consultants").select("available").eq("id",s.id).single();if(p)throw p;n(l?.available||!1);const{data:C,error:S}=await w.from("consultant_availability").select("*").eq("consultant_id",s.id);if(S)throw S;const y=ae.map((t,m)=>{const N=C?.filter(g=>g.day_of_week===m+1)?.map(g=>g.start_time.substring(0,5))||[];return{day:t,slots:N}});v(y)}catch(l){console.error("Error fetching availability:",l),r({title:"Error fetching availability",description:l.message||"Could not load your availability settings.",variant:"destructive"})}finally{i(!1)}}},o=async()=>{if(s){i(!0);try{const l=!u,{error:p}=await w.from("consultants").update({available:l}).eq("id",s.id);if(p)throw p;n(l),r({title:l?"You are now available":"You are now unavailable",description:l?"Clients can now book sessions with you.":"You won't receive new booking requests."})}catch(l){console.error("Error updating availability:",l),r({title:"Error updating availability",description:l.message||"Could not update your availability status.",variant:"destructive"})}finally{i(!1)}}},b=(l,p)=>{v(C=>C.map(S=>{if(S.day!==l)return S;const y=new Set(S.slots);return y.has(p)?y.delete(p):y.add(p),{...S,slots:Array.from(y)}}))},x=async()=>{if(s){i(!0);try{const{error:l}=await w.from("consultant_availability").delete().eq("consultant_id",s.id);if(l)throw l;const p=[];for(const C of j){const S=ae.indexOf(C.day)+1;for(const y of C.slots){const[t,m]=y.split(":").map(Number),g=`${(t+1).toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:00`;p.push({consultant_id:s.id,day_of_week:S,start_time:`${y}:00`,end_time:g})}}if(p.length>0){const{error:C}=await w.from("consultant_availability").insert(p);if(C)throw C}r({title:"Availability updated",description:"Your availability schedule has been saved successfully."})}catch(l){console.error("Error saving availability:",l),r({title:"Error saving availability",description:l.message||"Could not save your availability schedule.",variant:"destructive"})}finally{i(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Availability Status"}),e.jsx(X,{children:"Toggle your availability to receive booking requests from clients."})]}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(qe,{id:"availability-mode",checked:u,onCheckedChange:o,disabled:a}),e.jsx(z,{htmlFor:"availability-mode",className:"text-base",children:u?"Available for bookings":"Not available for bookings"})]})})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Weekly Schedule"}),e.jsx(X,{children:"Configure your available time slots for each day of the week."})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(E,{variant:"outline",size:"sm",className:"flex items-center",onClick:f,disabled:a,children:[e.jsx(ee,{className:"mr-1 h-4 w-4"}),a?"Loading...":"Refresh"]}),e.jsxs(E,{size:"sm",className:"flex items-center",onClick:x,disabled:a,children:[e.jsx(me,{className:"mr-1 h-4 w-4"}),a?"Saving...":"Save Schedule"]})]})]}),e.jsx(T,{children:e.jsx("div",{className:"space-y-6",children:j.map(l=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:l.day}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:is.map(p=>e.jsxs("div",{className:"flex items-center space-x-2 border rounded p-2",children:[e.jsx(Ce,{id:`${l.day}-${p}`,checked:l.slots.includes(p),onCheckedChange:()=>b(l.day,p),disabled:a}),e.jsx("label",{htmlFor:`${l.day}-${p}`,className:"text-sm cursor-pointer",children:p})]},`${l.day}-${p}`))})]},l.day))})})]})]})}function ls(){const{user:s,isConsultant:r}=O(),{toast:a}=G(),[i,u]=d.useState(!0),[n,j]=d.useState([]),[v,f]=d.useState(null),o=async()=>{if(!s){f("User not authenticated"),u(!1);return}u(!0),f(null);try{console.log("Fetching sessions for user:",s.id,"isConsultant:",r);let t;r?t=w.from("sessions").select("*").eq("consultant_id",s.id).order("start_time",{ascending:!1}):t=w.from("sessions").select("*").eq("user_id",s.id).order("start_time",{ascending:!1}),console.log("Executing sessions query...");const{data:m,error:N}=await t;if(N)throw console.error("Sessions query error:",N),new Error(`Failed to fetch sessions: ${N.message}`);if(console.log("Raw session data:",m),!m||m.length===0){console.log("No sessions found"),j([]);return}const g=new Set;m.forEach(c=>{r?g.add(c.user_id):g.add(c.consultant_id)}),console.log("Fetching user data for IDs:",Array.from(g));const{data:k,error:V}=await w.from("users").select("id, name, profile_image").in("id",Array.from(g));if(V)throw console.error("Users query error:",V),new Error(`Failed to fetch user data: ${V.message}`);console.log("Users data:",k);const Q=m.map(c=>{console.log("Transforming session:",c);const h=r?c.user_id:c.consultant_id,_=k?.find(D=>D.id===h);return{id:c.id,user_id:c.user_id,consultant_id:c.consultant_id,start_time:c.start_time,end_time:c.end_time,status:c.status,notes:c.notes,created_at:c.created_at,user:_?{name:_.name||"Unknown User",profile_image:_.profile_image||null}:null}});console.log("Transformed sessions:",Q),j(Q)}catch(t){console.error("Error fetching sessions:",t);const m=t.message||"Could not load your sessions.";f(m),a({title:"Error fetching sessions",description:m,variant:"destructive"})}finally{u(!1)}},b=async(t,m)=>{if(!s||!r){a({title:"Unauthorized",description:"Only consultants can update session status.",variant:"destructive"});return}u(!0);try{console.log("Updating session status:",t,m);const{error:N}=await w.from("sessions").update({status:m}).eq("id",t).eq("consultant_id",s.id);if(N)throw console.error("Error updating session:",N),new Error(`Failed to update session: ${N.message}`);j(g=>g.map(k=>k.id===t?{...k,status:m}:k)),a({title:"Session updated",description:`The session has been marked as ${m}.`})}catch(N){console.error("Update session error:",N),a({title:"Error updating session",description:N.message||"Could not update the session status.",variant:"destructive"})}finally{u(!1)}},x=n.filter(t=>(t.status==="scheduled"||t.status==="pending_payment_confirmation")&&We(K(t.start_time),new Date)),l=n.filter(t=>t.status==="completed"||t.status!=="cancelled"&&Ke(K(t.start_time),new Date)),p=n.filter(t=>t.status==="cancelled");return{sessions:n,isLoading:i,error:v,upcomingSessions:x,pastSessions:l,cancelledSessions:p,fetchSessions:o,updateSessionStatus:b,formatSessionDate:t=>{try{const m=K(t);return ie(m,"MMM dd, yyyy")}catch(m){return console.error("Error formatting date:",m),"Invalid date"}},formatSessionTime:t=>{try{const m=K(t);return ie(m,"h:mm a")}catch(m){return console.error("Error formatting time:",m),"Invalid time"}},getSessionDuration:(t,m)=>{try{const N=K(t);return`${(K(m).getTime()-N.getTime())/(1e3*60)} min`}catch(N){return console.error("Error calculating duration:",N),"Unknown duration"}}}}function os(){const{isConsultant:s}=O(),r=Ie(),{isLoading:a,error:i,upcomingSessions:u,pastSessions:n,cancelledSessions:j,fetchSessions:v,updateSessionStatus:f,formatSessionDate:o,formatSessionTime:b,getSessionDuration:x}=ls();d.useEffect(()=>{v()},[]);const l=y=>{switch(y){case"scheduled":return"outline";case"completed":return"default";case"pending_payment_confirmation":return"secondary";case"cancelled":return"destructive";default:return"outline"}},p=y=>{switch(y){case"pending_payment_confirmation":return"Pending Payment";default:return y.charAt(0).toUpperCase()+y.slice(1)}},C=y=>e.jsx("div",{className:"grid grid-cols-1 gap-4 w-full max-w-full",children:y.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No sessions found"}):y.map(t=>e.jsx(P,{className:"w-full max-w-full overflow-hidden",children:e.jsxs(T,{className:"p-4 w-full max-w-full",children:[e.jsx("div",{className:"flex items-start justify-between mb-3 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 overflow-hidden flex-shrink-0",children:t.user?.profile_image?e.jsx("img",{src:t.user.profile_image,alt:t.user?.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-mental-green-100 text-mental-green-800",children:t.user?.name?.charAt(0)?.toUpperCase()||"U"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium truncate",children:t.user?.name||"Unknown User"}),e.jsx(q,{variant:l(t.status),className:"mt-1",children:p(t.status)})]})]})}),e.jsxs("div",{className:"space-y-2 text-sm w-full max-w-full",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground min-w-0",children:[e.jsx(me,{className:"mr-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:o(t.start_time)})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground min-w-0",children:[e.jsx(ee,{className:"mr-2 h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[b(t.start_time)," â€¢ ",x(t.start_time,t.end_time)]})]})]}),s&&(t.status==="scheduled"||t.status==="pending_payment_confirmation")&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(E,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>f(t.id,"completed"),children:"Complete"}),e.jsx(E,{size:"sm",variant:"outline",className:"flex-1 text-red-600 hover:bg-red-50",onClick:()=>f(t.id,"cancelled"),children:"Cancel"})]})]})},t.id))}),S=y=>e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(J,{children:[e.jsx(L,{children:s?"Client":"Consultant"}),e.jsx(L,{children:"Date"}),e.jsx(L,{children:"Time"}),e.jsx(L,{children:"Duration"}),e.jsx(L,{children:"Status"}),s&&e.jsx(L,{children:"Actions"})]})}),e.jsxs(je,{children:[y.length===0&&e.jsx(J,{children:e.jsx(M,{colSpan:s?6:5,className:"text-center py-4",children:"No sessions found"})}),y.map(t=>e.jsxs(J,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-100 overflow-hidden",children:t.user?.profile_image?e.jsx("img",{src:t.user.profile_image,alt:t.user?.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-mental-green-100 text-mental-green-800",children:t.user?.name?.charAt(0)?.toUpperCase()||"U"})}),e.jsx("span",{className:"font-medium",children:t.user?.name||"Unknown User"})]})}),e.jsx(M,{children:o(t.start_time)}),e.jsx(M,{children:b(t.start_time)}),e.jsx(M,{children:x(t.start_time,t.end_time)}),e.jsx(M,{children:e.jsx(q,{variant:l(t.status),children:p(t.status)})}),s&&e.jsx(M,{children:e.jsx("div",{className:"flex space-x-2",children:(t.status==="scheduled"||t.status==="pending_payment_confirmation")&&e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"outline",onClick:()=>f(t.id,"completed"),children:"Complete"}),e.jsx(E,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",onClick:()=>f(t.id,"cancelled"),children:"Cancel"})]})})})]},t.id))]})]});return i?e.jsx("div",{className:"space-y-6",children:e.jsx(P,{children:e.jsx(T,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 font-medium",children:"Error loading sessions"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i}),e.jsxs(E,{onClick:v,variant:"outline",size:"sm",className:"mt-4",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Try Again"]})]})})})}):e.jsx("div",{className:"space-y-6 max-w-full",children:e.jsxs(P,{className:"max-w-full overflow-hidden",children:[e.jsx(F,{className:"max-w-full",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(I,{className:"truncate",children:"Your Sessions"})}),e.jsxs(E,{variant:"outline",size:"sm",className:"flex items-center flex-shrink-0",onClick:v,disabled:a,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})}),e.jsx(T,{className:"w-full max-w-full overflow-hidden",children:e.jsxs(fe,{defaultValue:"upcoming",className:"w-full max-w-full overflow-hidden",children:[e.jsxs(xe,{className:"mb-4 w-full max-w-full flex flex-wrap overflow-hidden",children:[e.jsxs(Y,{value:"upcoming",children:["Upcoming",u.length>0&&e.jsx(q,{variant:"secondary",className:"ml-2",children:u.length})]}),e.jsxs(Y,{value:"past",children:["Past",n.length>0&&e.jsx(q,{variant:"secondary",className:"ml-2",children:n.length})]}),e.jsxs(Y,{value:"cancelled",children:["Cancelled",j.length>0&&e.jsx(q,{variant:"secondary",className:"ml-2",children:j.length})]})]}),e.jsx(B,{value:"upcoming",className:"pt-2",children:a?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading upcoming sessions..."})}):r?C(u):S(u)}),e.jsx(B,{value:"past",className:"pt-2",children:a?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading past sessions..."})}):r?C(n):S(n)}),e.jsx(B,{value:"cancelled",className:"pt-2",children:a?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading cancelled sessions..."})}):r?C(j):S(j)})]})})]})})}function cs(){const{user:s}=O(),{toast:r}=G(),[a,i]=d.useState(!0),[u,n]=d.useState([]);d.useEffect(()=>{s&&j()},[s]);const j=async()=>{if(s){i(!0);try{const{data:f,error:o}=await w.from("stories").select("*").eq("author_id",s.id).order("published_at",{ascending:!1});if(o)throw o;const b=f?f.map(x=>({id:x.id,title:x.title,snippet:x.snippet,content:x.content,cover_image:x.cover_image,tags:x.tags,tag_type:x.tag_type||"mental",author_id:x.author_id,is_featured:x.is_featured,is_anonymous:x.is_anonymous||!1,published_at:x.published_at,created_at:x.created_at,updated_at:x.updated_at})):[];n(b)}catch(f){r({title:"Error fetching stories",description:f.message||"Could not load your stories.",variant:"destructive"})}finally{i(!1)}}};return{stories:u,isLoading:a,handleDeleteStory:async f=>{if(confirm("Are you sure you want to delete this story? This action cannot be undone."))try{const{error:o}=await w.from("stories").delete().eq("id",f).eq("author_id",s?.id);if(o)throw o;n(b=>b.filter(x=>x.id!==f)),r({title:"Story deleted",description:"Your story has been deleted successfully."})}catch(o){r({title:"Error deleting story",description:o.message||"Could not delete your story.",variant:"destructive"})}},refetchStories:j}}function ds({story:s,onEdit:r,onDelete:a}){const i=u=>{try{const n=K(u);return ie(n,"MMM dd, yyyy")}catch{return u}};return e.jsxs(P,{className:"overflow-hidden border",children:[e.jsxs("div",{className:"aspect-video relative",children:[e.jsx("img",{src:s.cover_image||"/placeholder.svg",alt:s.title,className:"object-cover w-full h-full"}),s.is_featured&&e.jsx(q,{className:"absolute top-2 right-2 bg-mental-green-600",children:"Featured"})]}),e.jsxs(F,{className:"pb-2",children:[e.jsx(I,{className:"line-clamp-1",children:s.title}),e.jsx("div",{className:"flex items-center text-sm text-muted-foreground",children:e.jsxs("span",{children:["Published on ",i(s.published_at)]})})]}),e.jsxs(T,{className:"pb-2",children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.snippet}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.tags.slice(0,3).map(u=>e.jsx(q,{variant:"outline",className:"text-xs",children:u},u)),s.tags.length>3&&e.jsxs(q,{variant:"outline",className:"text-xs",children:["+",s.tags.length-3," more"]})]})]}),e.jsxs(Ae,{className:"justify-between pt-2",children:[e.jsx($e,{to:`/story/${s.id}`,children:e.jsxs(E,{variant:"outline",size:"sm",children:[e.jsx(he,{className:"mr-2 h-4 w-4"})," Read"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>r(s),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",className:"text-red-500 hover:bg-red-50 hover:text-red-600",onClick:()=>a(s.id),children:e.jsx(Ye,{className:"h-4 w-4"})})]})]})]})}function us(){return e.jsxs("div",{className:"text-center py-10 space-y-4",children:[e.jsx(he,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-medium",children:"No stories yet"})}),e.jsx(re,{children:e.jsxs(E,{className:"mt-4",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Create Your First Story"]})})]})}function ms(){const{stories:s,isLoading:r,handleDeleteStory:a}=cs(),[i,u]=d.useState(null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between",children:[e.jsx("div",{children:e.jsx(I,{children:"Your Stories"})}),e.jsx(re,{})]}),e.jsx(T,{children:r?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading your stories..."})}):s.length===0?e.jsx(us,{}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(n=>e.jsx(ds,{story:n,onEdit:u,onDelete:a},n.id))})})]}),i&&e.jsx(re,{story:i,onOpenChange:()=>u(null)})]})}function Fs(){const{profile:s,isConsultant:r,isAdmin:a}=O();return s?e.jsx(ce,{children:e.jsxs("div",{className:"container mx-auto py-6 px-4 pb-20 sm:pb-6 max-w-full overflow-x-hidden",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Your Profile"}),e.jsxs(fe,{defaultValue:"settings",className:"w-full max-w-full",children:[e.jsxs(xe,{className:"mb-4",children:[e.jsx(Y,{value:"settings",children:"Settings"}),r&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{value:"finances",children:"Finances"}),e.jsx(Y,{value:"availability",children:"Availability"})]}),e.jsx(Y,{value:"sessions",children:"Sessions"}),e.jsx(Y,{value:"stories",children:"Stories"})]}),e.jsx(B,{value:"settings",children:e.jsx(Ze,{isConsultant:r,isAdmin:a})}),r&&e.jsxs(e.Fragment,{children:[e.jsx(B,{value:"finances",children:e.jsx(Je,{})}),e.jsx(B,{value:"availability",children:e.jsx(ns,{})})]}),e.jsx(B,{value:"sessions",children:e.jsx(os,{})}),e.jsx(B,{value:"stories",children:e.jsx(ms,{})})]})]})}):e.jsx(ce,{children:e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Loading profile..."})})})}export{Fs as ProfilePage,Fs as default};
