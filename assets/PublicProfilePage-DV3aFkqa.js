import{j as e}from"./ui-BG7jjlrC.js";import{u as y}from"./query-C_TmXHuV.js";import{C as o,h,i as u,B as j,k as d,g,o as _,s as b,f as w,M as C,u as P,a as z,L as f}from"./index-Xuc-BpSe.js";import{f as E}from"./chatUtils-9oZEBGJt.js";import{L,b as q,u as M}from"./router-J7O6VmFe.js";import{p as A}from"./parseISO-G0xhW6v5.js";import{f as D}from"./format-Dmqbz6eD.js";import{M as S,G as F}from"./map-pin-_6eD1Q6F.js";import{D as k}from"./dollar-sign-DP54sH2j.js";import"./vendor-CsPsgsBv.js";import"./utils-EL5wpLGY.js";import"./supabase-DoZrjKS4.js";import"./en-US-DcT3sm5m.js";function T({userId:s,userName:r}){const{data:i,isLoading:x}=y({queryKey:["userPosts",s],queryFn:async()=>{const{data:a,error:c}=await b.from("stories").select("id, title, snippet, cover_image, tags, tag_type, published_at, is_featured").eq("author_id",s).eq("status","published").order("published_at",{ascending:!1});if(c)throw c;return(a||[]).map(n=>({id:n.id,title:n.title,snippet:n.snippet,cover_image:n.cover_image,tags:n.tags,tag_type:n.tag_type,published_at:n.published_at,is_featured:n.is_featured}))},enabled:!!s}),m=a=>{try{const c=A(a);return D(c,"MMM dd, yyyy")}catch{return a}},t={mental:"bg-blue-100 text-blue-800",control:"bg-purple-100 text-purple-800",drugs:"bg-red-100 text-red-800",life:"bg-green-100 text-green-800",anxiety:"bg-yellow-100 text-yellow-800",depression:"bg-gray-100 text-gray-800"};return x?e.jsxs(o,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(j,{size:20}),"Posts by ",r]})}),e.jsx(d,{children:e.jsx("div",{className:"text-center py-4",children:"Loading posts..."})})]}):!i||i.length===0?e.jsxs(o,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(j,{size:20}),"Posts by ",r]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(j,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No posts published yet"})]})})]}):e.jsxs(o,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(j,{size:20}),"Posts by ",r," (",i.length,")"]})}),e.jsx(d,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(a=>e.jsx(L,{to:`/story/${a.id}`,className:"group block",children:e.jsxs(o,{className:"overflow-hidden transition-all hover:shadow-md border",children:[e.jsxs("div",{className:"aspect-video relative",children:[e.jsx("img",{src:a.cover_image||"/placeholder.svg",alt:a.title,className:"object-cover w-full h-full group-hover:scale-105 transition-transform",onError:c=>{c.target.src="/placeholder.svg"}}),a.is_featured&&e.jsx(g,{className:"absolute top-2 right-2 bg-mental-green-600",children:"Featured"})]}),e.jsxs(d,{className:"p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(g,{variant:"outline",className:t[a.tag_type]||"bg-gray-100 text-gray-800",children:a.tags[0]||a.tag_type})}),e.jsx("h3",{className:"font-bold text-lg mb-2 line-clamp-2 group-hover:text-mental-green-600 transition-colors",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3",children:a.snippet}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(_,{size:14,className:"mr-1"}),e.jsx("span",{children:m(a.published_at)})]})]})]})},a.id))})})]})}function O({profile:s,onStartChat:r}){const i=s.role==="consultant"||s.role==="admin"||s.role==="owner",x="https://raw.githubusercontent.com/Our-Minds/our-minds.github.io/refs/heads/main/public/assets/default.png",m=s.profile_image?s.profile_image:x;return e.jsx(o,{className:"mb-6",children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[e.jsx("img",{src:m,alt:s.name,className:"w-32 h-32 rounded-full object-cover",onError:t=>{t.target.src=x}}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.name}),i&&s.consultant&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-2",children:[e.jsx(g,{variant:s.consultant.available?"default":"secondary",children:s.consultant.available?"Available":"Unavailable"}),e.jsx(g,{variant:"outline",children:s.role})]}),e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-4 text-sm text-gray-600",children:[s.consultant.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{size:16}),e.jsx("span",{children:s.consultant.location})]}),s.consultant.hourly_rate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{size:16}),e.jsxs("span",{children:["$",s.consultant.hourly_rate,"/hour"]})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(w,{onClick:r,className:"flex items-center gap-2",children:[e.jsx(C,{size:16}),"Start Chat"]})})]})]})})})}function B({consultant:s}){return e.jsxs(e.Fragment,{children:[s.bio&&e.jsxs(o,{className:"mb-6",children:[e.jsx(h,{children:e.jsx(u,{children:"About"})}),e.jsx(d,{children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.bio})})]}),s.specialization&&s.specialization.length>0&&e.jsxs(o,{className:"mb-6",children:[e.jsx(h,{children:e.jsx(u,{children:"Specializations"})}),e.jsx(d,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.specialization.map((r,i)=>e.jsx(g,{variant:"outline",children:r},i))})})]}),s.languages&&s.languages.length>0&&e.jsxs(o,{className:"mb-6",children:[e.jsx(h,{children:e.jsx(u,{children:"Languages"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:16,className:"text-gray-500"}),e.jsx("span",{children:s.languages.join(", ")})]})})]})]})}function Z(){const{userId:s}=q(),{user:r,isAuthenticated:i}=P(),x=M(),{toast:m}=z(),{data:t,isLoading:a}=y({queryKey:["publicProfile",s],queryFn:async()=>{if(!s)throw new Error("User ID is required");const{data:l,error:v}=await b.from("users").select("id, name, profile_image, role").eq("id",s).single();if(v)throw v;if(l.role==="consultant"||l.role==="admin"||l.role==="owner"){const{data:N,error:p}=await b.from("consultants").select("bio, specialization, location, languages, hourly_rate, rating, review_count, available").eq("id",s).single();return p&&p.code!=="PGRST116"&&console.error("Error fetching consultant data:",p),{...l,consultant:N||void 0}}return l},enabled:!!s}),c=async()=>{if(!i){m({title:"Authentication required",description:"Please login to chat with this user",variant:"destructive"}),x("/login");return}if(!(!s||!r)){if(r.id===s){m({title:"Cannot chat with yourself",description:"You cannot start a chat with yourself",variant:"destructive"});return}try{const l=await E(s,r.id);x(`/chat/${l.id}`)}catch(l){console.error("Error starting chat:",l),m({title:"Failed to start chat",description:l.message||"An error occurred",variant:"destructive"})}}};if(a)return e.jsx(f,{children:e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsx("div",{className:"text-center",children:"Loading profile..."})})});if(!t)return e.jsx(f,{children:e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Profile not found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})});const n=t.role==="consultant"||t.role==="admin"||t.role==="owner";return e.jsx(f,{children:e.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-4xl",children:[e.jsx(O,{profile:t,onStartChat:c}),n&&t.consultant&&e.jsx(B,{consultant:t.consultant}),e.jsx("div",{className:"mb-6",children:e.jsx(T,{userId:t.id,userName:t.name})})]})})}export{Z as PublicProfilePage,Z as default};
