import{j as e}from"./ui-BG7jjlrC.js";import{u as N}from"./query-C_TmXHuV.js";import{C as o,h as x,i as u,B as j,j as d,g,o as _,s as y,f as w,M as C,u as P,a as z,L as v}from"./index-CvhVXczW.js";import{f as q}from"./chatUtils-Ctqdd6qY.js";import{L as E,b as L,u as M}from"./router-J7O6VmFe.js";import{p as A}from"./parseISO-G0xhW6v5.js";import{f as D}from"./format-Dmqbz6eD.js";import{M as S,G as F}from"./map-pin-B0iOPddX.js";import{D as O}from"./dollar-sign-GZkvHI9w.js";import"./vendor-CsPsgsBv.js";import"./utils-EL5wpLGY.js";import"./supabase-DoZrjKS4.js";import"./en-US-DcT3sm5m.js";function T({userId:s,userName:i,currentUserId:m}){const c=m===s,{data:n,isLoading:r}=N({queryKey:["userPosts",s,c],queryFn:async()=>{let a=y.from("stories").select("id, title, snippet, cover_image, tags, tag_type, published_at, is_featured, is_anonymous").eq("author_id",s).eq("status","published");c||(a=a.eq("is_anonymous",!1));const{data:t,error:h}=await a.order("published_at",{ascending:!1});if(h)throw h;return(t||[]).map(l=>({id:l.id,title:l.title,snippet:l.snippet,cover_image:l.cover_image,tags:l.tags,tag_type:l.tag_type,published_at:l.published_at,is_featured:l.is_featured}))},enabled:!!s}),p=a=>{try{const t=A(a);return D(t,"MMM dd, yyyy")}catch{return a}},f={mental:"bg-blue-100 text-blue-800",control:"bg-purple-100 text-purple-800",drugs:"bg-red-100 text-red-800",life:"bg-green-100 text-green-800",anxiety:"bg-yellow-100 text-yellow-800",depression:"bg-gray-100 text-gray-800"};return r?e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(j,{size:20}),"Posts by ",i]})}),e.jsx(d,{children:e.jsx("div",{className:"text-center py-4",children:"Loading posts..."})})]}):!n||n.length===0?e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(j,{size:20}),"Posts by ",i]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(j,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No posts published yet"})]})})]}):e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(j,{size:20}),"Posts by ",i," (",n.length,")"]})}),e.jsx(d,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(a=>e.jsx(E,{to:`/story/${a.id}`,className:"group block",children:e.jsxs(o,{className:"overflow-hidden transition-all hover:shadow-md border",children:[e.jsxs("div",{className:"aspect-video relative",children:[e.jsx("img",{src:a.cover_image||"/placeholder.svg",alt:a.title,className:"object-cover w-full h-full group-hover:scale-105 transition-transform",onError:t=>{t.target.src="/placeholder.svg"}}),a.is_featured&&e.jsx(g,{className:"absolute top-2 right-2 bg-mental-green-600",children:"Featured"})]}),e.jsxs(d,{className:"p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(g,{variant:"outline",className:f[a.tag_type]||"bg-gray-100 text-gray-800",children:a.tags[0]||a.tag_type})}),e.jsx("h3",{className:"font-bold text-lg mb-2 line-clamp-2 group-hover:text-mental-green-600 transition-colors",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3",children:a.snippet}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(_,{size:14,className:"mr-1"}),e.jsx("span",{children:p(a.published_at)})]})]})]})},a.id))})})]})}function k({profile:s,onStartChat:i}){const m=s.role==="consultant"||s.role==="admin"||s.role==="owner",c="https://raw.githubusercontent.com/Our-Minds/our-minds.github.io/refs/heads/main/public/assets/default.png",n=s.profile_image?s.profile_image:c;return e.jsx(o,{className:"mb-6",children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[e.jsx("img",{src:n,alt:s.name,className:"w-32 h-32 rounded-full object-cover",onError:r=>{r.target.src=c}}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.name}),m&&s.consultant&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-2",children:[e.jsx(g,{variant:s.consultant.available?"default":"secondary",children:s.consultant.available?"Available":"Unavailable"}),e.jsx(g,{variant:"outline",children:s.role})]}),e.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-4 text-sm text-gray-600",children:[s.consultant.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{size:16}),e.jsx("span",{children:s.consultant.location})]}),s.consultant.hourly_rate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{size:16}),e.jsxs("span",{children:["$",s.consultant.hourly_rate,"/hour"]})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(w,{onClick:i,className:"flex items-center gap-2",children:[e.jsx(C,{size:16}),"Start Chat"]})})]})]})})})}function U({consultant:s}){return e.jsxs(e.Fragment,{children:[s.bio&&e.jsxs(o,{className:"mb-6",children:[e.jsx(x,{children:e.jsx(u,{children:"About"})}),e.jsx(d,{children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.bio})})]}),s.specialization&&s.specialization.length>0&&e.jsxs(o,{className:"mb-6",children:[e.jsx(x,{children:e.jsx(u,{children:"Specializations"})}),e.jsx(d,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.specialization.map((i,m)=>e.jsx(g,{variant:"outline",children:i},m))})})]}),s.languages&&s.languages.length>0&&e.jsxs(o,{className:"mb-6",children:[e.jsx(x,{children:e.jsx(u,{children:"Languages"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:16,className:"text-gray-500"}),e.jsx("span",{children:s.languages.join(", ")})]})})]})]})}function Z(){const{userId:s}=L(),{user:i,isAuthenticated:m}=P(),c=M(),{toast:n}=z(),{data:r,isLoading:p}=N({queryKey:["publicProfile",s],queryFn:async()=>{if(!s)throw new Error("User ID is required");const{data:t,error:h}=await y.from("users").select("id, name, profile_image, role").eq("id",s).single();if(h)throw h;if(t.role==="consultant"||t.role==="admin"||t.role==="owner"){const{data:l,error:b}=await y.from("consultants").select("bio, specialization, location, languages, hourly_rate, rating, review_count, available").eq("id",s).single();return b&&b.code!=="PGRST116"&&console.error("Error fetching consultant data:",b),{...t,consultant:l||void 0}}return t},enabled:!!s}),f=async()=>{if(!m){n({title:"Authentication required",description:"Please login to chat with this user",variant:"destructive"}),c("/login");return}if(!(!s||!i)){if(i.id===s){n({title:"Cannot chat with yourself",description:"You cannot start a chat with yourself",variant:"destructive"});return}try{const t=await q(s,i.id);c(`/chat/${t.id}`)}catch(t){console.error("Error starting chat:",t),n({title:"Failed to start chat",description:t.message||"An error occurred",variant:"destructive"})}}};if(p)return e.jsx(v,{children:e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsx("div",{className:"text-center",children:"Loading profile..."})})});if(!r)return e.jsx(v,{children:e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Profile not found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})});const a=r.role==="consultant"||r.role==="admin"||r.role==="owner";return e.jsx(v,{children:e.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-4xl",children:[e.jsx(k,{profile:r,onStartChat:f}),a&&r.consultant&&e.jsx(U,{consultant:r.consultant}),e.jsx("div",{className:"mb-6",children:e.jsx(T,{userId:r.id,userName:r.name,currentUserId:i?.id})})]})})}export{Z as PublicProfilePage,Z as default};
