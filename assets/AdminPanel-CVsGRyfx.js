import{j as e}from"./ui-CqCCPo1Y.js";import{r as w}from"./vendor-CsPsgsBv.js";import{L as ve,d as ye,u as be,N as Ne}from"./router-J7O6VmFe.js";import{g as de,h as D,T as Z,a as ee,b as K,c as b,d as se,e as v,k as te,f as me,i as z,j as ie,S as J}from"./switch-xpGmgMKx.js";import{c as T,B as h,u as S,s as u,C as V,e as Q,f as H,h as I,g as Y,t as C,d as B,a as ae,L as p,I as f,S as we,l as Ce,m as Se,n as _e,o as R,j as Ee,X as G,T as W,P as ke,p as le}from"./index-Cz0ZLwjf.js";import{U as re,M as Ae,D as Fe,a as Me,b as Te,c as oe,d as qe,e as De,f as ze,g as Ue,h as Le}from"./dialog-JXTE8grn.js";import{u as L,b as U,c as M}from"./query-2sWkym1G.js";import{S as _}from"./skeleton-Dp-g5sVM.js";import{C as ue}from"./calendar-D_CFiBTG.js";import{c as he}from"./constructNow-CztL-i6M.js";import{s as ce,f as O}from"./format-CM1khF8F.js";import{t as Pe,c as Re}from"./en-US-ktNFwBEl.js";import{A as Ke,a as Ve,b as Qe}from"./avatar-DNfy2UMe.js";import{S as He}from"./star-BZJzuXdS.js";import{E as xe}from"./eye-DqUHTlT3.js";import"./supabase-DoZrjKS4.js";import"./utils-EL5wpLGY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=T("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=T("ChartColumnIncreasing",[["path",{d:"M13 17V9",key:"1fwyjl"}],["path",{d:"M18 17V5",key:"sfb6ij"}],["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=T("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=T("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=T("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=T("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=T("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=T("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=T("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=T("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function Je(a,t){const s=Pe(a);return isNaN(t)?Re(a,NaN):(s.setDate(s.getDate()+t),s)}function ge(a,t){const s=ce(a),r=ce(t);return+s==+r}function We(a){return ge(a,he(a))}function Xe(a,t){return Je(a,-t)}function Ze(a){return ge(a,Xe(he(a),1))}const es=()=>e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your platform, users, and content"})]}),e.jsx(h,{asChild:!0,className:"mt-4 md:mt-0",children:e.jsxs(ve,{to:"/home",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Back to Main Site"]})})]}),ss=({activeTab:a})=>e.jsxs(de,{className:"grid grid-cols-6 w-full",children:[e.jsxs(D,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]}),e.jsxs(D,{value:"users",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Users"})]}),e.jsxs(D,{value:"content",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Content"})]}),e.jsxs(D,{value:"consultants",className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Consultants"})]}),e.jsxs(D,{value:"about",className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"About"})]}),e.jsxs(D,{value:"settings",className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Settings"})]})]}),ts=()=>{const{isAdmin:a}=S();return L({queryKey:["dashboard-stats"],queryFn:async()=>{if(!a)throw new Error("Unauthorized");try{const{count:t,error:s}=await u.from("users").select("*",{count:"exact",head:!0});if(s)throw console.error("Error fetching user count:",s),s;const r=new Date;r.setDate(r.getDate()-7);const{count:o,error:c}=await u.from("stories").select("*",{count:"exact",head:!0}).gte("created_at",r.toISOString());if(c)throw console.error("Error fetching recent stories count:",c),c;const{count:l,error:d}=await u.from("consultants").select("*",{count:"exact",head:!0}).eq("available",!1);if(d)throw console.error("Error fetching pending approvals count:",d),d;return{totalUsers:t||0,recentStories:o||0,pendingApprovals:l||0}}catch(t){throw console.error("Error in useDashboardStats:",t),t}},enabled:!!a,retry:2,retryDelay:1e3})},as=()=>{const{isAdmin:a}=S();return L({queryKey:["recent-activities"],queryFn:async()=>{if(!a)throw new Error("Unauthorized");try{const{data:t,error:s}=await u.from("users").select("id, name, created_at").order("created_at",{ascending:!1}).limit(3);if(s)throw console.error("Error fetching recent users:",s),s;const{data:r,error:o}=await u.from("stories").select("id, title, created_at").order("created_at",{ascending:!1}).limit(3);if(o)throw console.error("Error fetching recent stories:",o),o;const{data:c,error:l}=await u.from("sessions").select("id, user_id, consultant_id, start_time, created_at").order("created_at",{ascending:!1}).limit(2);if(l)throw console.error("Error fetching recent sessions:",l),l;const d=[...(t||[]).map(n=>({id:`user-${n.id}`,type:"user_joined",text:`New user ${n.name||"Anonymous"} joined the platform`,timestamp:n.created_at})),...(r||[]).map(n=>({id:`story-${n.id}`,type:"story_published",text:`New story "${n.title||"Untitled"}" was published`,timestamp:n.created_at})),...(c||[]).map(n=>({id:`session-${n.id}`,type:"session_booked",text:"New consultation session was booked",timestamp:n.created_at}))];return d.sort((n,x)=>new Date(x.timestamp).getTime()-new Date(n.timestamp).getTime()),d.slice(0,5)}catch(t){throw console.error("Error in useRecentActivities:",t),t}},enabled:!!a,retry:2,retryDelay:1e3})},$=({title:a,value:t,icon:s,trend:r})=>e.jsxs(V,{children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:a}),s]}),e.jsxs(I,{children:[t===void 0?e.jsx(_,{className:"h-7 w-16"}):e.jsx("div",{className:"text-2xl font-bold",children:t.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r})]})]}),rs=({stats:a,isLoading:t})=>e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx($,{title:"Total Users",value:t?void 0:a?.totalUsers,icon:e.jsx(re,{className:"h-4 w-4 text-muted-foreground"}),trend:"+10% from last month"}),e.jsx($,{title:"Active Stories",value:t?void 0:a?.recentStories,icon:e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),trend:"+20% from last month"}),e.jsx($,{title:"Pending Approvals",value:t?void 0:a?.pendingApprovals,icon:e.jsx(je,{className:"h-4 w-4 text-muted-foreground"}),trend:`${a?.pendingApprovals?a.pendingApprovals:0} consultants waiting`}),e.jsx($,{title:"Chat Messages",value:57,icon:e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),trend:"+15% from last month"}),e.jsx($,{title:"Sessions",value:128,icon:e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"}),trend:"+8% from last month"})]}),ns=({activities:a})=>{const t=r=>{switch(r){case"user_joined":return e.jsx(re,{className:"h-4 w-4"});case"story_published":return e.jsx(ne,{className:"h-4 w-4"});case"session_booked":return e.jsx(ue,{className:"h-4 w-4"});default:return null}},s=r=>{const o=new Date(r);return We(o)?`Today at ${O(o,"h:mm a")}`:Ze(o)?`Yesterday at ${O(o,"h:mm a")}`:O(o,"MMM d, yyyy")};return e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsx("p",{className:"text-center py-4 text-muted-foreground",children:"No recent activity"}):a.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-muted rounded-md",children:[e.jsx("div",{className:"flex items-center justify-center h-8 w-8 rounded-full bg-muted",children:t(r.type)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:r.text}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s(r.timestamp)})]})]},r.id))})},is=({activities:a,isLoading:t,error:s})=>e.jsxs(V,{className:"col-span-full",children:[e.jsxs(Q,{children:[e.jsx(H,{children:"Recent Activity"}),e.jsx(Y,{children:"Platform activities from the last few days"})]}),e.jsx(I,{children:t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"})]}):s?e.jsx("p",{className:"text-center py-4 text-muted-foreground",children:"Failed to load recent activities"}):e.jsx(ns,{activities:a||[]})})]}),ls=()=>e.jsxs(V,{className:"col-span-full",children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(H,{children:"Monthly Overview"}),e.jsx(Y,{children:"Platform performance metrics for the past 30 days"})]}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]})}),e.jsx(I,{children:e.jsx("div",{className:"h-[200px] w-full rounded-md bg-muted/30 flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Chart visualization will appear here"})})})]}),os=()=>{const{data:a,isLoading:t,error:s}=ts(),{data:r,isLoading:o,error:c}=as();return e.jsxs("div",{className:"space-y-4",children:[e.jsx(rs,{stats:a,isLoading:t}),e.jsx(is,{activities:r,isLoading:o,error:c}),e.jsx(ls,{})]})},cs=()=>{const{isAdmin:a}=S();return L({queryKey:["admin-users"],queryFn:async()=>{if(!a)throw new Error("Unauthorized");const{data:t,error:s}=await u.from("users").select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching users:",s),s;return t},enabled:!!a,retry:2,retryDelay:1e3})},ds=()=>{const a=U(),{isAdmin:t}=S();return M({mutationFn:async({userId:s,newRole:r})=>{if(!t)throw new Error("Unauthorized");const{error:o}=await u.from("users").update({role:r}).eq("id",s);if(o)throw o;return{userId:s,newRole:r}},onSuccess:s=>{a.invalidateQueries({queryKey:["admin-users"]}),C({title:"User role updated",description:`User has been promoted to ${s.newRole}.`})},onError:s=>{C({title:"Failed to update user role",description:s.message||"An error occurred while updating the user role.",variant:"destructive"})}})},ms=()=>{const a=U(),{isAdmin:t}=S();return M({mutationFn:async s=>{if(!t)throw new Error("Unauthorized");const{error:r}=await u.from("users").delete().eq("id",s);if(r)throw r;return{userId:s}},onSuccess:()=>{a.invalidateQueries({queryKey:["admin-users"]}),C({title:"User removed",description:"The user has been removed from the platform."})},onError:s=>{C({title:"Failed to remove user",description:s.message||"An error occurred while removing the user.",variant:"destructive"})}})},us=()=>{const{isAdmin:a}=S();return L({queryKey:["admin-stories"],queryFn:async()=>{if(!a)throw new Error("Unauthorized");const{data:t,error:s}=await u.from("stories").select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching stories:",s),s;return t},enabled:!!a,retry:2,retryDelay:1e3})},hs=()=>{const a=U(),{isAdmin:t}=S();return M({mutationFn:async({storyId:s,isFeatured:r})=>{if(!t)throw new Error("Unauthorized");const{error:o}=await u.from("stories").update({is_featured:r}).eq("id",s);if(o)throw o;return{storyId:s,isFeatured:r}},onSuccess:()=>{a.invalidateQueries({queryKey:["admin-stories"]}),C({title:"Story updated",description:"The story feature status has been updated."})},onError:s=>{C({title:"Failed to update story",description:s.message||"An error occurred while updating the story.",variant:"destructive"})}})},xs=()=>{const a=U(),{isAdmin:t}=S();return M({mutationFn:async s=>{if(!t)throw new Error("Unauthorized");const{error:r}=await u.from("stories").delete().eq("id",s);if(r)throw r;return s},onSuccess:()=>{a.invalidateQueries({queryKey:["admin-stories"]}),C({title:"Story deleted",description:"The story has been deleted successfully."})},onError:s=>{C({title:"Failed to delete story",description:s.message||"An error occurred while deleting the story.",variant:"destructive"})}})},ps=()=>{const{isAdmin:a}=S();return L({queryKey:["all-consultants"],queryFn:async()=>{if(!a)throw new Error("Unauthorized");console.log("Fetching all consultants...");try{const{data:t,error:s}=await u.from("consultants").select(`
            id, 
            specialization, 
            created_at,
            approval_status,
            available
          `).order("created_at",{ascending:!1});if(s)throw console.error("Error fetching consultants:",s),s;if(console.log("Found all consultants:",t),!t||t.length===0)return console.log("No consultants found"),[];const r=t.map(d=>d.id),{data:o,error:c}=await u.from("users").select("id, name, email").in("id",r);if(c)throw console.error("Error fetching users:",c),c;console.log("Found users for consultants:",o);const l=t.map(d=>{const n=o?.find(x=>x.id===d.id);return{id:d.id,name:n?.name||"Unknown",email:n?.email||"no-email@example.com",specialization:d.specialization||[],submittedDate:O(new Date(d.created_at),"yyyy-MM-dd"),status:d.approval_status}});return console.log("Final all consultants data:",l),l}catch(t){throw console.error("Error in useAllConsultants:",t),t}},enabled:!!a,retry:2,retryDelay:1e3})},js=()=>{const a=U(),{isAdmin:t}=S();return M({mutationFn:async s=>{if(!t)throw new Error("Unauthorized");console.log("Approving consultant:",s);const{error:r}=await u.from("consultants").update({approval_status:"approved",available:!0}).eq("id",s);if(r)throw console.error("Error approving consultant:",r),r;return{consultantId:s}},onSuccess:()=>{a.invalidateQueries({queryKey:["pending-consultants"]}),a.invalidateQueries({queryKey:["all-consultants"]}),a.invalidateQueries({queryKey:["approved-consultants"]}),C({title:"Consultant approved",description:"The consultant has been approved and is now available for sessions."})},onError:s=>{console.error("Failed to approve consultant:",s),C({title:"Failed to approve consultant",description:s.message||"An error occurred while approving the consultant.",variant:"destructive"})}})},gs=()=>{const a=U(),{isAdmin:t}=S();return M({mutationFn:async s=>{if(!t)throw new Error("Unauthorized");console.log("Rejecting consultant:",s);const{error:r}=await u.from("consultants").update({approval_status:"rejected",available:!1}).eq("id",s);if(r)throw console.error("Error rejecting consultant:",r),r;return{consultantId:s}},onSuccess:()=>{a.invalidateQueries({queryKey:["pending-consultants"]}),a.invalidateQueries({queryKey:["all-consultants"]}),a.invalidateQueries({queryKey:["approved-consultants"]}),C({title:"Consultant rejected",description:"The consultant application has been rejected."})},onError:s=>{console.error("Failed to reject consultant:",s),C({title:"Failed to reject consultant",description:s.message||"An error occurred while rejecting the consultant.",variant:"destructive"})}})},fs=()=>{const{isAdmin:a}=S();return L({queryKey:["admin-settings"],queryFn:async()=>{if(!a)throw new Error("Unauthorized");try{const{data:t,error:s}=await u.from("platform_settings").select("*").order("created_at",{ascending:!0}).limit(1).maybeSingle();if(s)throw console.error("Error fetching platform settings:",s),s;if(!t){console.log("No platform settings found, creating default");const r={mission:"Our mission is to make mental health support accessible to everyone, everywhere.",vision:"We envision a world where mental health is treated with the same importance as physical health.",values:"Compassion, Accessibility, Quality, Privacy, and Inclusion.",platform_fee_percentage:4},{data:o,error:c}=await u.from("platform_settings").insert(r).select().single();if(c)throw console.error("Error creating default platform settings:",c),c;return o}return t}catch(t){throw console.error("Error in useAdminSettings:",t),t}},enabled:!!a,retry:2,retryDelay:1e3})},vs=()=>{const a=U(),{isAdmin:t}=S();return M({mutationFn:async s=>{if(!t)throw new Error("Unauthorized");let r;const{data:o,error:c}=await u.from("platform_settings").select("id").order("created_at",{ascending:!0}).limit(1).single();if(c)if(c.code==="PGRST116"){const{data:l,error:d}=await u.from("platform_settings").insert(s).select("id").single();if(d)throw d;if(!l)throw new Error("Failed to create settings");r=l.id}else throw c;else{r=o.id;const{error:l}=await u.from("platform_settings").update(s).eq("id",r);if(l)throw l}return{...s,id:r}},onSuccess:()=>{a.invalidateQueries({queryKey:["admin-settings"]}),C({title:"Settings saved",description:"Platform settings have been updated successfully."})},onError:s=>{C({title:"Failed to save settings",description:s.message||"An error occurred while saving settings.",variant:"destructive"})}})},ys=()=>{const{data:a,isLoading:t,error:s}=cs(),r=ds(),o=ms(),c=(n,x)=>{r.mutate({userId:n,newRole:x})},l=n=>{window.confirm("Are you sure you want to remove this user?")&&o.mutate(n)},d=n=>n.split(" ").map(x=>x[0]).join("").toUpperCase().substring(0,2);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"User Management"}),e.jsx(h,{size:"sm",children:"Add User"})]}),e.jsx("div",{className:"rounded-md border",children:t?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"})]}):s?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{children:"Failed to load users"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.message})]}):a&&a.length>0?e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(K,{children:[e.jsx(b,{children:"User"}),e.jsx(b,{children:"Email"}),e.jsx(b,{children:"Role"}),e.jsx(b,{children:"Joined"}),e.jsx(b,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:a.map(n=>e.jsxs(K,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Ke,{children:[e.jsx(Ve,{src:n.profile_image||void 0}),e.jsx(Qe,{children:d(n.name)})]}),e.jsx("span",{children:n.name})]})}),e.jsx(v,{children:n.email}),e.jsx(v,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${n.role==="admin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:n.role})}),e.jsx(v,{children:O(new Date(n.created_at),"MMM d, yyyy")}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(Fe,{children:[e.jsx(Me,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(Ge,{className:"h-4 w-4"})})}),e.jsxs(Te,{align:"end",children:[e.jsx(oe,{onClick:()=>c(n.id,"user"),children:"Set as User"}),e.jsx(oe,{onClick:()=>c(n.id,"admin"),children:"Set as Admin"})]})]}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>l(n.id),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})]})})]},n.id))})]}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{children:"No users found"})})})]})},bs=()=>{const{data:a,isLoading:t,error:s}=us(),r=hs(),o=xs(),c=(n,x)=>{r.mutate({storyId:n,isFeatured:!x})},l=(n,x)=>{window.confirm(`Are you sure you want to delete "${x}"? This action cannot be undone.`)&&o.mutate(n)},d=(n,x=50)=>n.length>x?n.substring(0,x)+"...":n;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Content Management"}),e.jsx(h,{size:"sm",children:"Add Content"})]}),e.jsx("div",{className:"rounded-md border",children:t?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"})]}):s?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{children:"Failed to load content"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.message})]}):a&&a.length>0?e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(K,{children:[e.jsx(b,{children:"Title"}),e.jsx(b,{children:"Snippet"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Published"}),e.jsx(b,{children:"Featured"}),e.jsx(b,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:a.map(n=>e.jsxs(K,{children:[e.jsx(v,{children:d(n.title,30)}),e.jsx(v,{children:d(n.snippet||"",50)}),e.jsx(v,{children:e.jsx(B,{variant:n.status==="published"?"default":"outline",children:n.status||"published"})}),e.jsx(v,{children:O(new Date(n.published_at),"MMM d, yyyy")}),e.jsx(v,{children:e.jsx(B,{variant:n.is_featured?"secondary":"outline",children:n.is_featured?"Featured":"Not featured"})}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>c(n.id,n.is_featured),children:n.is_featured?e.jsx(Ye,{className:"h-4 w-4"}):e.jsx(He,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>l(n.id,n.title),className:"text-destructive hover:text-destructive",children:e.jsx(te,{className:"h-4 w-4"})})]})})]},n.id))})]}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{children:"No stories found"})})})]})},Ns=({children:a})=>{const[t,s]=w.useState(!1),[r,o]=w.useState(""),[c,l]=w.useState(""),[d,n]=w.useState(""),[x,N]=w.useState(""),[k,g]=w.useState(!1),{toast:A}=ae(),j=U(),y=async F=>{F.preventDefault(),g(!0);try{const{data:q,error:i}=await u.auth.admin.createUser({email:c,password:"temp123!",email_confirm:!0});if(i)throw i;const m=q.user.id,{error:E}=await u.from("users").insert({id:m,name:r,email:c,role:"consultant",profile_image:`https://ui-avatars.com/api/?name=${r.charAt(0)}&background=random&color=fff`});if(E)throw E;const{error:P}=await u.from("consultants").insert({id:m,specialization:[d],languages:["English"],location:x||"Remote",bio:"",paypal_email:c,approval_status:"approved",available:!0,hourly_rate:50});if(P)throw P;A({title:"Consultant added successfully",description:"The consultant has been added and approved automatically."}),o(""),l(""),n(""),N(""),s(!1),j.invalidateQueries({queryKey:["pending-consultants"]}),j.invalidateQueries({queryKey:["approved-consultants"]})}catch(q){console.error("Error adding consultant:",q),A({title:"Failed to add consultant",description:q.message||"An error occurred while adding the consultant.",variant:"destructive"})}finally{g(!1)}};return e.jsxs(qe,{open:t,onOpenChange:s,children:[e.jsx(De,{asChild:!0,children:a}),e.jsxs(ze,{className:"sm:max-w-md",children:[e.jsx(Ue,{children:e.jsx(Le,{children:"Add New Consultant"})}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Full Name"}),e.jsx(f,{id:"name",value:r,onChange:F=>o(F.target.value),placeholder:"Enter consultant name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"Email"}),e.jsx(f,{id:"email",type:"email",value:c,onChange:F=>l(F.target.value),placeholder:"Enter consultant email",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"specialization",children:"Specialization"}),e.jsxs(we,{value:d,onValueChange:n,children:[e.jsx(Ce,{children:e.jsx(Se,{placeholder:"Select specialization"})}),e.jsxs(_e,{children:[e.jsx(R,{value:"General Mental Health",children:"General Mental Health"}),e.jsx(R,{value:"Anxiety",children:"Anxiety"}),e.jsx(R,{value:"Depression",children:"Depression"}),e.jsx(R,{value:"Trauma",children:"Trauma"}),e.jsx(R,{value:"Addiction",children:"Addiction"}),e.jsx(R,{value:"PTSD",children:"PTSD"}),e.jsx(R,{value:"Family Therapy",children:"Family Therapy"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"location",children:"Location"}),e.jsx(f,{id:"location",value:x,onChange:F=>N(F.target.value),placeholder:"Enter location (optional)"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:k,children:"Cancel"}),e.jsx(h,{type:"submit",disabled:k,children:k?"Adding...":"Add Consultant"})]})]})]})]})},ws=()=>{const{data:a,isLoading:t,error:s,refetch:r}=ps(),o=js(),c=gs();console.log("ConsultantManagementTab - consultants:",a),console.log("ConsultantManagementTab - isLoading:",t),console.log("ConsultantManagementTab - error:",s);const l=j=>{console.log("Approving consultant:",j),o.mutate(j)},d=j=>{console.log("Rejecting consultant:",j),c.mutate(j)},n=()=>{console.log("Manually refreshing consultant data..."),r()},x=a?.filter(j=>j.status==="pending")||[],N=a?.filter(j=>j.status==="approved")||[],k=a?.filter(j=>j.status==="rejected")||[],g=j=>{switch(j){case"approved":return"default";case"pending":return"secondary";case"rejected":return"destructive";default:return"outline"}},A=j=>e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(K,{children:[e.jsx(b,{children:"Name"}),e.jsx(b,{children:"Email"}),e.jsx(b,{children:"Specialization"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Submitted"}),e.jsx(b,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:j.length===0?e.jsx(K,{children:e.jsx(v,{colSpan:6,className:"text-center py-4",children:"No consultants found in this category"})}):j.map(y=>e.jsxs(K,{children:[e.jsx(v,{children:y.name}),e.jsx(v,{children:y.email}),e.jsx(v,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[y.specialization.slice(0,3).map((F,q)=>e.jsx(B,{variant:"outline",className:"text-xs",children:F},q)),y.specialization.length>3&&e.jsxs(B,{variant:"outline",className:"text-xs",children:["+",y.specialization.length-3," more"]})]})}),e.jsx(v,{children:e.jsx(B,{variant:g(y.status),children:y.status.charAt(0).toUpperCase()+y.status.slice(1)})}),e.jsx(v,{children:y.submittedDate}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[y.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>l(y.id),disabled:o.isPending,className:"text-green-600 hover:bg-green-50",title:"Approve consultant",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>d(y.id),disabled:c.isPending,className:"text-red-600 hover:bg-red-50",title:"Reject consultant",children:e.jsx(G,{className:"h-4 w-4"})})]}),e.jsx(h,{variant:"ghost",size:"icon",title:"View details",children:e.jsx(xe,{className:"h-4 w-4"})})]})})]},y.id))})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Consultant Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:n,disabled:t,children:[e.jsx(Oe,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Refresh"]}),e.jsx(Ns,{children:e.jsx(h,{size:"sm",children:"Add Consultant"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.length}),e.jsx("div",{className:"text-sm text-blue-600",children:"Pending"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N.length}),e.jsx("div",{className:"text-sm text-green-600",children:"Approved"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:k.length}),e.jsx("div",{className:"text-sm text-red-600",children:"Rejected"})]})]}),e.jsx("div",{className:"rounded-md border",children:t?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"}),e.jsx(_,{className:"h-12 w-full"})]}):s?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-600 font-medium",children:"Failed to load consultants"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.message}),e.jsx(h,{onClick:n,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]}):e.jsxs(me,{defaultValue:"pending",className:"w-full",children:[e.jsxs(de,{className:"grid w-full grid-cols-3",children:[e.jsxs(D,{value:"pending",children:["Pending (",x.length,")"]}),e.jsxs(D,{value:"approved",children:["Approved (",N.length,")"]}),e.jsxs(D,{value:"rejected",children:["Rejected (",k.length,")"]})]}),e.jsx(z,{value:"pending",className:"mt-4",children:A(x)}),e.jsx(z,{value:"approved",className:"mt-4",children:A(N)}),e.jsx(z,{value:"rejected",className:"mt-4",children:A(k)})]})})]})};function Cs(){const[a,t]=w.useState(null),[s,r]=w.useState(null),[o,c]=w.useState(!1),{toast:l}=ae(),d=U(),{data:n,isLoading:x}=L({queryKey:["adminAboutContent"],queryFn:async()=>{const{data:i,error:m}=await u.from("about_content").select("section, title, content").order("section");if(m)throw m;return i}}),{data:N,isLoading:k}=L({queryKey:["adminTeamMembers"],queryFn:async()=>{const{data:i,error:m}=await u.from("team_members").select("*").order("display_order");if(m)throw m;return i}}),g=M({mutationFn:async({section:i,title:m,content:E})=>{const{error:P}=await u.from("about_content").update({title:m,content:E}).eq("section",i);if(P)throw P},onSuccess:()=>{d.invalidateQueries({queryKey:["adminAboutContent"]}),d.invalidateQueries({queryKey:["aboutContent"]}),l({title:"Content updated successfully"}),t(null)},onError:i=>{l({title:"Error updating content",description:i.message,variant:"destructive"})}}),A=M({mutationFn:async i=>{const{error:m}=await u.from("team_members").insert([{...i,is_active:!0}]);if(m)throw m},onSuccess:()=>{d.invalidateQueries({queryKey:["adminTeamMembers"]}),d.invalidateQueries({queryKey:["teamMembers"]}),l({title:"Team member added successfully"}),c(!1)},onError:i=>{l({title:"Error adding team member",description:i.message,variant:"destructive"})}}),j=M({mutationFn:async({id:i,...m})=>{const{error:E}=await u.from("team_members").update(m).eq("id",i);if(E)throw E},onSuccess:()=>{d.invalidateQueries({queryKey:["adminTeamMembers"]}),d.invalidateQueries({queryKey:["teamMembers"]}),l({title:"Team member updated successfully"}),r(null)},onError:i=>{l({title:"Error updating team member",description:i.message,variant:"destructive"})}}),y=M({mutationFn:async i=>{const{error:m}=await u.from("team_members").update({is_active:!1}).eq("id",i);if(m)throw m},onSuccess:()=>{d.invalidateQueries({queryKey:["adminTeamMembers"]}),d.invalidateQueries({queryKey:["teamMembers"]}),l({title:"Team member removed successfully"})},onError:i=>{l({title:"Error removing team member",description:i.message,variant:"destructive"})}}),F=i=>{i.preventDefault();const m=new FormData(i.currentTarget),E=m.get("section"),P=m.get("title"),fe=m.get("content");g.mutate({section:E,title:P,content:fe})},q=i=>{i.preventDefault();const m=new FormData(i.currentTarget),E={name:m.get("name"),position:m.get("position"),bio:m.get("bio")||null,profile_image:m.get("profile_image")||null,email:m.get("email")||null,linkedin_url:m.get("linkedin_url")||null,display_order:parseInt(m.get("display_order"))||0};s?j.mutate({id:s,...E}):A.mutate(E)};return x||k?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold",children:"About Page Management"})}),e.jsxs(V,{children:[e.jsx(Q,{children:e.jsx(H,{children:"Page Content"})}),e.jsx(I,{className:"space-y-4",children:n?.map(i=>e.jsx("div",{className:"border rounded-lg p-4",children:a===i.section?e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsx("input",{type:"hidden",name:"section",value:i.section}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",children:"Title"}),e.jsx(f,{id:"title",name:"title",defaultValue:i.title,required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"content",children:"Content"}),e.jsx(W,{id:"content",name:"content",defaultValue:i.content,rows:4,required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{type:"submit",size:"sm",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Save"]}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:()=>t(null),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",children:i.title}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>t(i.section),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Edit"]})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:i.content})]})},i.section))})]}),e.jsxs(V,{children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{children:"Team Members"}),e.jsxs(h,{onClick:()=>c(!0),children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Add Member"]})]})}),e.jsxs(I,{className:"space-y-4",children:[o&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Add New Team Member"}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"name",children:"Name"}),e.jsx(f,{id:"name",name:"name",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"position",children:"Position"}),e.jsx(f,{id:"position",name:"position",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"bio",children:"Bio"}),e.jsx(W,{id:"bio",name:"bio",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"email",children:"Email"}),e.jsx(f,{id:"email",name:"email",type:"email"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"linkedin_url",children:"LinkedIn URL"}),e.jsx(f,{id:"linkedin_url",name:"linkedin_url",type:"url"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"profile_image",children:"Profile Image URL"}),e.jsx(f,{id:"profile_image",name:"profile_image",type:"url"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"display_order",children:"Display Order"}),e.jsx(f,{id:"display_order",name:"display_order",type:"number",defaultValue:"0"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{type:"submit",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Save"]}),e.jsxs(h,{type:"button",variant:"outline",onClick:()=>c(!1),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]}),N?.map(i=>e.jsx("div",{className:"border rounded-lg p-4",children:s===i.id?e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"name",children:"Name"}),e.jsx(f,{id:"name",name:"name",defaultValue:i.name,required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"position",children:"Position"}),e.jsx(f,{id:"position",name:"position",defaultValue:i.position,required:!0})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"bio",children:"Bio"}),e.jsx(W,{id:"bio",name:"bio",defaultValue:i.bio||"",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"email",children:"Email"}),e.jsx(f,{id:"email",name:"email",type:"email",defaultValue:i.email||""})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"linkedin_url",children:"LinkedIn URL"}),e.jsx(f,{id:"linkedin_url",name:"linkedin_url",type:"url",defaultValue:i.linkedin_url||""})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"profile_image",children:"Profile Image URL"}),e.jsx(f,{id:"profile_image",name:"profile_image",type:"url",defaultValue:i.profile_image||""})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"display_order",children:"Display Order"}),e.jsx(f,{id:"display_order",name:"display_order",type:"number",defaultValue:i.display_order})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{type:"submit",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Save"]}),e.jsxs(h,{type:"button",variant:"outline",onClick:()=>r(null),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:i.profile_image||"/placeholder.svg",alt:i.name,className:"w-12 h-12 rounded-full object-cover",onError:m=>{m.target.src="/placeholder.svg"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.name}),e.jsx(B,{variant:"outline",children:i.position}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Order: ",i.display_order]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>r(i.id),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(h,{variant:"destructive",size:"sm",onClick:()=>y.mutate(i.id),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Remove"]})]})]})},i.id))]})]})]})}const Ss=()=>{const{toast:a}=ae(),{data:t,isLoading:s,error:r}=fs(),{mutate:o,isPending:c}=vs(),[l,d]=w.useState({platformName:"",contactEmail:"",platformFee:4,enableChat:!0,enableBooking:!0,enableStories:!0}),[n,x]=w.useState(!1);w.useEffect(()=>{t&&!n&&(console.log("Loading platform settings into form:",t),d({platformName:t.mission?.split(" - ")[0]||"Mental Health App",contactEmail:t.contact_email||"support@example.com",platformFee:t.platform_fee_percentage||4,enableChat:t.enable_chat??!0,enableBooking:t.enable_booking??!0,enableStories:t.enable_stories??!0}),x(!0))},[t,n]);const N=(g,A)=>{console.log(`Updating ${g} to:`,A),d(j=>({...j,[g]:A}))},k=()=>{if(console.log("Saving platform settings:",l),l.platformFee<0||l.platformFee>100){a({title:"Invalid platform fee",description:"Platform fee must be between 0 and 100%",variant:"destructive"});return}if(!l.contactEmail.includes("@")){a({title:"Invalid email",description:"Please enter a valid contact email",variant:"destructive"});return}if(!l.platformName.trim()){a({title:"Invalid platform name",description:"Platform name cannot be empty",variant:"destructive"});return}o({platform_fee_percentage:l.platformFee,mission:`${l.platformName} - Our mission is to make mental health support accessible to everyone, everywhere.`,contact_email:l.contactEmail,enable_chat:l.enableChat,enable_booking:l.enableBooking,enable_stories:l.enableStories})};return s?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(le,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading settings..."})]}):r?e.jsxs("div",{className:"p-4 text-center text-red-600",children:[e.jsxs("p",{children:["Error loading settings: ",r.message]}),e.jsx(h,{onClick:()=>window.location.reload(),variant:"outline",className:"mt-2",children:"Retry"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Platform Settings"}),e.jsxs(h,{onClick:k,disabled:c,children:[c&&e.jsx(le,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Settings"]})]}),e.jsxs(V,{children:[e.jsxs(Q,{children:[e.jsx(H,{children:"General Settings"}),e.jsx(Y,{children:"Manage platform-wide configuration"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"platformName",children:"Platform Name"}),e.jsx(f,{id:"platformName",type:"text",placeholder:"Mental Health App",value:l.platformName,onChange:g=>N("platformName",g.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"contactEmail",children:"Contact Email"}),e.jsx(f,{id:"contactEmail",type:"email",placeholder:"support@example.com",value:l.contactEmail,onChange:g=>N("contactEmail",g.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"platformFee",children:"Platform Fee (%)"}),e.jsx(f,{id:"platformFee",type:"number",placeholder:"10",min:"0",max:"100",value:l.platformFee,onChange:g=>N("platformFee",parseFloat(g.target.value)||0)})]})]})]}),e.jsxs(V,{children:[e.jsxs(Q,{children:[e.jsx(H,{children:"Feature Toggles"}),e.jsx(Y,{children:"Enable or disable platform features"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(p,{htmlFor:"enableChat",children:"Enable Chat Feature"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow users to chat with consultants"})]}),e.jsx(J,{id:"enableChat",checked:l.enableChat,onCheckedChange:g=>N("enableChat",g)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(p,{htmlFor:"enableBooking",children:"Enable Consultant Booking"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow users to book sessions with consultants"})]}),e.jsx(J,{id:"enableBooking",checked:l.enableBooking,onCheckedChange:g=>N("enableBooking",g)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(p,{htmlFor:"enableStories",children:"Enable Public Stories"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow users to view and share stories publicly"})]}),e.jsx(J,{id:"enableStories",checked:l.enableStories,onCheckedChange:g=>N("enableStories",g)})]})]})]})]})},Hs=()=>{const[a,t]=ye();be();const s=a.get("tab")||"dashboard",[r,o]=w.useState(s),{isAuthenticated:c,isAdmin:l,loading:d}=S();w.useEffect(()=>{r!==s&&t({tab:r},{replace:!0})},[r,t,s]);const n=x=>{o(x)};return d?e.jsx("div",{className:"container mx-auto p-6 flex items-center justify-center min-h-[50vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading admin panel..."})]})}):!c||!l?e.jsx(Ne,{to:"/login",replace:!0}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(es,{}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("div",{className:"col-span-1",children:e.jsxs(me,{defaultValue:r,onValueChange:n,className:"space-y-4",children:[e.jsx(ss,{activeTab:r}),e.jsx(z,{value:"dashboard",className:"space-y-4",children:e.jsx(os,{})}),e.jsx(z,{value:"users",className:"space-y-4",children:e.jsx(ys,{})}),e.jsx(z,{value:"content",className:"space-y-4",children:e.jsx(bs,{})}),e.jsx(z,{value:"consultants",className:"space-y-4",children:e.jsx(ws,{})}),e.jsx(z,{value:"about",className:"space-y-4",children:e.jsx(Cs,{})}),e.jsx(z,{value:"settings",className:"space-y-4",children:e.jsx(Ss,{})})]})})})]})};export{Hs as default};
