import{j as e}from"./ui-BG7jjlrC.js";import{d as b,u as m,s as x,F as u,f as c,g as j,E as N}from"./index-CvhVXczW.js";import{u as S,b as y,c as g}from"./query-C_TmXHuV.js";import{T,a as F,b as p,c as o,d as q,e as d}from"./table-ItZkQoZb.js";import{S as h}from"./skeleton-6Y4fJ80v.js";import{S as A}from"./star-C7tKwoGQ.js";import{T as C}from"./trash-2-ylsRDHL7.js";import{f as E}from"./format-Dmqbz6eD.js";import"./vendor-CsPsgsBv.js";import"./router-J7O6VmFe.js";import"./utils-EL5wpLGY.js";import"./supabase-DoZrjKS4.js";import"./en-US-DcT3sm5m.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=b("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),z=()=>{const{isAdmin:r}=m();return S({queryKey:["admin-stories"],queryFn:async()=>{if(!r)throw new Error("Unauthorized");const{data:a,error:s}=await x.from("stories").select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching stories:",s),s;return a},enabled:!!r,retry:2,retryDelay:1e3})},_=()=>{const r=y(),{isAdmin:a}=m();return g({mutationFn:async({storyId:s,isFeatured:i})=>{if(!a)throw new Error("Unauthorized");const{error:l}=await x.from("stories").update({is_featured:i}).eq("id",s);if(l)throw l;return{storyId:s,isFeatured:i}},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-stories"]}),u({title:"Story updated",description:"The story feature status has been updated."})},onError:s=>{u({title:"Failed to update story",description:s.message||"An error occurred while updating the story.",variant:"destructive"})}})},k=()=>{const r=y(),{isAdmin:a}=m();return g({mutationFn:async s=>{if(!a)throw new Error("Unauthorized");const{error:i}=await x.from("stories").delete().eq("id",s);if(i)throw i;return s},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-stories"]}),u({title:"Story deleted",description:"The story has been deleted successfully."})},onError:s=>{u({title:"Failed to delete story",description:s.message||"An error occurred while deleting the story.",variant:"destructive"})}})},V=()=>{const{data:r,isLoading:a,error:s}=z(),i=_(),l=k(),w=(t,n)=>{i.mutate({storyId:t,isFeatured:!n})},v=(t,n)=>{window.confirm(`Are you sure you want to delete "${n}"? This action cannot be undone.`)&&l.mutate(t)},f=(t,n=50)=>t.length>n?t.substring(0,n)+"...":t;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Content Management"}),e.jsx(c,{size:"sm",children:"Add Content"})]}),e.jsx("div",{className:"rounded-md border",children:a?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(h,{className:"h-12 w-full"}),e.jsx(h,{className:"h-12 w-full"}),e.jsx(h,{className:"h-12 w-full"})]}):s?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{children:"Failed to load content"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.message})]}):r&&r.length>0?e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(p,{children:[e.jsx(o,{children:"Title"}),e.jsx(o,{children:"Snippet"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Published"}),e.jsx(o,{children:"Featured"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsx(q,{children:r.map(t=>e.jsxs(p,{children:[e.jsx(d,{children:f(t.title,30)}),e.jsx(d,{children:f(t.snippet||"",50)}),e.jsx(d,{children:e.jsx(j,{variant:t.status==="published"?"default":"outline",children:t.status||"published"})}),e.jsx(d,{children:E(new Date(t.published_at),"MMM d, yyyy")}),e.jsx(d,{children:e.jsx(j,{variant:t.is_featured?"secondary":"outline",children:t.is_featured?"Featured":"Not featured"})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>w(t.id,t.is_featured),children:t.is_featured?e.jsx(M,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",children:e.jsx(N,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>v(t.id,t.title),className:"text-destructive hover:text-destructive",children:e.jsx(C,{className:"h-4 w-4"})})]})})]},t.id))})]}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{children:"No stories found"})})})]})};export{V as ContentManagementTab,V as default};
