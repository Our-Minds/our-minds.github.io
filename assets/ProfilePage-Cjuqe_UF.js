import{j as e,a as Ce,u as Se,n as _e,P as de,d as le,p as Ee,q as ke}from"./ui-CqCCPo1Y.js";import{B as ue,C as ae,L as oe}from"./Layout-LrLnQRNT.js";import{T as me,a as he,b as J,c as M,d as fe,e as L,S as Pe,f as xe,g as pe,h as Y,i as B,j as Te,k as De}from"./switch-xpGmgMKx.js";import{r as d}from"./vendor-CsPsgsBv.js";import{c as se,a as G,u as V,B as k,X as ge,I as q,P as Fe,d as H,s as C,C as P,e as F,f as I,g as R,h as T,L as z,i as Ie,b as ce,j as Ae,k as Le}from"./index-Cz0ZLwjf.js";import{A as Me,a as Re,b as Ue}from"./avatar-DNfy2UMe.js";import{D as qe}from"./dollar-sign-CUlpiUT9.js";import{C as re}from"./clock-C9qB3zDw.js";import{C as $e}from"./calendar-D_CFiBTG.js";import{t as ee}from"./en-US-ktNFwBEl.js";import{p as X}from"./parseISO-deY9M3ki.js";import{f as ie}from"./format-CM1khF8F.js";import{L as ze}from"./router-J7O6VmFe.js";import"./dialog-JXTE8grn.js";import"./query-2sWkym1G.js";import"./supabase-DoZrjKS4.js";import"./utils-EL5wpLGY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=se("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=se("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=se("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=se("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);function Ve(s,a){const t=ee(s),r=ee(a);return t.getTime()>r.getTime()}function We(s,a){const t=ee(s),r=ee(a);return+t<+r}function Ke({currentImage:s,onImageChange:a,size:t="md"}){const{toast:r}=G(),{user:u}=V(),i=d.useRef(null),[y,b]=d.useState(null),[p,l]=d.useState(!1),N={sm:"h-20 w-20",md:"h-32 w-32",lg:"h-40 w-40"},g="https://raw.githubusercontent.com/Our-Minds/our-minds.github.io/refs/heads/main/public/assets/default.png",n=async c=>{const m=c.target.files?.[0];if(!m)return;if(!m.type.startsWith("image/")){r({title:"Invalid file type",description:"Please upload an image file",variant:"destructive"});return}if(m.size>5*1024*1024){r({title:"File too large",description:"Image must be less than 5MB",variant:"destructive"});return}const w=new FileReader;w.onload=()=>{const j=w.result;b(j)},w.readAsDataURL(m);try{l(!0),await a(m),r({title:"Image uploaded",description:"Your profile image has been updated successfully."})}catch(j){console.error("Error uploading image:",j),r({title:"Upload failed",description:j.message||"Could not upload your image. Please try again.",variant:"destructive"}),b(null)}finally{l(!1)}},x=()=>{i.current&&i.current.click()},v=async()=>{try{l(!0),b(null),i.current&&(i.current.value=""),await a(null),r({title:"Image removed",description:"Your profile image has been removed."})}catch(c){r({title:"Error removing image",description:c.message||"Could not remove your profile image.",variant:"destructive"})}finally{l(!1)}},f=y||s||g,_=u?.email?.[0].toUpperCase()||"U";return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Me,{className:`${N[t]} border-2 border-gray-200`,children:[e.jsx(Re,{src:f,onError:c=>{c.target.src=g}}),e.jsx(Ue,{className:"text-3xl",children:_})]}),e.jsxs("div",{className:"absolute -bottom-2 -right-2 flex gap-1",children:[e.jsxs(k,{type:"button",size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full shadow",onClick:x,disabled:p,children:[e.jsx(Ye,{size:16}),e.jsx("span",{className:"sr-only",children:"Upload image"})]}),f&&e.jsxs(k,{type:"button",size:"icon",variant:"destructive",className:"h-8 w-8 rounded-full shadow",onClick:v,disabled:p,children:[e.jsx(ge,{size:16}),e.jsx("span",{className:"sr-only",children:"Remove image"})]})]})]}),e.jsx("input",{type:"file",className:"hidden",ref:i,onChange:n,accept:"image/*"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:p?"Uploading...":"Click the camera icon to update your profile image"})]})}function Xe({tags:s,onChange:a,maxTags:t=6}){const{toast:r}=G(),[u,i]=d.useState(""),y=()=>{const l=u.trim();if(l){if(s.includes(l)){r({title:"Tag already exists",description:"This tag has already been added.",variant:"destructive"});return}if(s.length>=t){r({title:"Maximum tags reached",description:`You can only add up to ${t} tags.`,variant:"destructive"});return}a([...s,l]),i("")}},b=l=>{l.key==="Enter"&&(l.preventDefault(),y())},p=l=>{a(s.filter(N=>N!==l))};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{value:u,onChange:l=>i(l.target.value),onKeyDown:b,placeholder:"Add a specialization tag...",className:"flex-1",disabled:s.length>=t}),e.jsxs(k,{type:"button",onClick:y,disabled:!u.trim()||s.length>=t,children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"})," Add"]})]}),s.length>=t&&e.jsxs("p",{className:"text-amber-600 text-sm",children:["Maximum of ",t," tags reached"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[s.map((l,N)=>e.jsxs(H,{variant:"secondary",className:"px-2 py-1 text-sm",children:[l,e.jsxs("button",{type:"button",onClick:()=>p(l),className:"ml-1 text-gray-500 hover:text-gray-700 focus:outline-none",children:[e.jsx(ge,{size:14}),e.jsxs("span",{className:"sr-only",children:["Remove ",l]})]})]},l)),s.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"No tags added yet"})]})]})}async function Ge(s,a){if(!a)return null;try{const t=a.split("/"),r=t[t.length-1];if(a.includes(`/${s}/`))return a;const{data:u,error:i}=await C.storage.from("profile_images").download(r);if(i)return console.error("Error downloading old profile image:",i),a;const y=`${s}/${r}`,{error:b}=await C.storage.from("profile_images").upload(y,u,{cacheControl:"3600",upsert:!0});if(b)return console.error("Error uploading to new path:",b),a;const{data:p}=C.storage.from("profile_images").getPublicUrl(y),{error:l}=await C.from("users").update({profile_image:p.publicUrl}).eq("id",s);return l&&console.error("Error updating user profile:",l),p.publicUrl}catch(t){return console.error("Profile image migration failed:",t),a}}function Qe({isConsultant:s=!1,isAdmin:a=!1}){const{profile:t,user:r,refreshProfile:u}=V(),{toast:i}=G(),[y,b]=d.useState(!1),[p,l]=d.useState(t?.profileImage||""),[N,g]=d.useState(t?.name||""),[n,x]=d.useState(t?.bio||""),[v,f]=d.useState(t?.specialization||["Anxiety","Depression","Stress Management"]),[_,c]=d.useState("Remote"),[m,w]=d.useState(["English"]),[j,E]=d.useState(50);d.useEffect(()=>{t&&(g(t.name||""),l(t.profileImage||""),x(t.bio||""),f(t.specialization||["Anxiety","Depression","Stress Management"]),s&&W())},[t,s]);const W=async()=>{if(r)try{const{data:h,error:S}=await C.from("consultants").select("location, languages, hourly_rate").eq("id",r.id).single();if(S){console.log("No consultant record found, using defaults");return}h&&(c(h.location||"Remote"),w(h.languages||["English"]),E(h.hourly_rate||50))}catch(h){console.error("Error fetching consultant details:",h)}};d.useEffect(()=>{(async()=>{if(r&&t?.profileImage)try{if(!t.profileImage.includes(`/${r.id}/`)){console.log("Attempting to migrate profile image");const S=await Ge(r.id,t.profileImage);S&&S!==t.profileImage&&(l(S),i({title:"Profile image updated",description:"Your profile image has been migrated to a new format."}))}}catch(S){console.error("Error migrating profile image:",S)}})()},[r,t?.profileImage,i]);const Q=async h=>{if(!r)throw new Error("User not authenticated");if(h===null){l("");return}if(typeof h=="string"){l(h);return}try{const S=h.name.split(".").pop(),D=`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${S}`,K=`${r.id}/${D}`,{error:U,data:Z}=await C.storage.from("profile_images").upload(K,h,{cacheControl:"3600",upsert:!0});if(U)throw U;const{data:A}=C.storage.from("profile_images").getPublicUrl(K);l(A.publicUrl)}catch(S){throw console.error("Error uploading profile image:",S),new Error(S.message||"Failed to upload image")}},o=async()=>{if(!r||!t){i({title:"Not authenticated",description:"You need to be logged in to update your profile.",variant:"destructive"});return}b(!0);try{const{error:h}=await C.from("users").update({name:N,profile_image:p}).eq("id",r.id);if(h)throw h;if(s){const{data:S}=await C.from("consultants").select("id").eq("id",r.id).single();if(S){const{error:D}=await C.from("consultants").update({specialization:v,bio:n,location:_,languages:m,hourly_rate:j}).eq("id",r.id);if(D)throw D}else{const{error:D}=await C.from("consultants").insert({id:r.id,specialization:v,bio:n,location:_,languages:m,hourly_rate:j,paypal_email:""});if(D)throw D}}u&&await u(),i({title:"Profile updated",description:"Your profile changes have been saved."})}catch(h){i({title:"Update failed",description:h.message||"There was an error saving your profile. Please try again.",variant:"destructive"})}finally{b(!1)}};return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Profile Picture"}),e.jsx(R,{children:"Update your profile picture. This will be visible to other users."})]}),e.jsx(T,{className:"flex justify-center",children:e.jsx(Ke,{currentImage:p,onImageChange:Q,size:"lg"})})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Personal Information"}),e.jsx(R,{children:"Update your personal information."})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"name",children:"Full Name"}),e.jsx(q,{id:"name",value:N,onChange:h=>g(h.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"email",children:"Email"}),e.jsx(q,{id:"email",value:t.email||"",type:"email",disabled:!0})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"role",children:"Role"}),e.jsx(q,{id:"role",value:"Administrator",disabled:!0})]})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Consultant Details"}),e.jsx(R,{children:"Update your location, languages, and hourly rate."})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"location",children:"Location"}),e.jsx(q,{id:"location",value:_,onChange:h=>c(h.target.value),placeholder:"e.g., Remote, New York, London"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"languages",children:"Languages (comma-separated)"}),e.jsx(q,{id:"languages",value:m.join(", "),onChange:h=>w(h.target.value.split(",").map(S=>S.trim()).filter(Boolean)),placeholder:"e.g., English, Spanish, French"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"hourly-rate",children:"Hourly Rate ($)"}),e.jsx(q,{id:"hourly-rate",type:"number",value:j,onChange:h=>E(Number(h.target.value)),min:"0",step:"5"})]})]})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Consultant Specializations"}),e.jsx(R,{children:"Add up to 6 specialization tags. The first 3 tags will be displayed on your public profile."})]}),e.jsx(T,{children:e.jsx(Xe,{tags:v,onChange:f,maxTags:6})})]})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Bio"}),e.jsx(R,{children:"Tell others a little about yourself."})]}),e.jsx(T,{children:e.jsx("textarea",{className:"flex min-h-[120px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",placeholder:"Write a short bio...",value:n,onChange:h=>x(h.target.value)})})]}),e.jsx("div",{className:"flex justify-end pt-4 pb-8 sm:pb-4",children:e.jsx(k,{onClick:o,disabled:y,className:"w-full sm:w-auto",children:y?"Saving...":"Save Changes"})})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:"Loading profile..."})}function Ze(){const{toast:s}=G(),{user:a,profile:t}=V(),[r,u]=d.useState([]),[i,y]=d.useState(""),[b,p]=d.useState(!1),[l,N]=d.useState(""),[g,n]=d.useState(!1),[x,v]=d.useState(0),[f,_]=d.useState(0),[c,m]=d.useState(0);d.useEffect(()=>{a&&(w(),j())},[a]);const w=async()=>{if(a)try{const{data:o,error:h}=await C.from("consultants").select("paypal_email").eq("id",a.id).single();if(h)throw h;o&&(y(o.paypal_email||""),N(o.paypal_email||""))}catch(o){console.error("Error fetching consultant data:",o),s({title:"Error loading consultant data",description:o.message,variant:"destructive"})}},j=async()=>{if(a){n(!0);try{const{data:o,error:h}=await C.from("transactions").select("*").eq("consultant_id",a.id).order("created_at",{ascending:!1});if(h)throw h;const S=await Promise.all((o||[]).map(async D=>{let K="Unknown Client";if(D.session_id)try{const{data:U}=await C.from("sessions").select("user_id").eq("id",D.session_id).single();if(U){const{data:Z}=await C.from("users").select("name").eq("id",U.user_id).single();Z&&(K=Z.name)}}catch(U){console.error("Error fetching user name:",U)}return{...D,user_name:K}}));u(S),E(S)}catch(o){console.error("Error fetching transactions:",o),s({title:"Error loading transactions",description:o.message,variant:"destructive"})}finally{n(!1)}}},E=o=>{const h=o.filter(A=>A.status==="completed"),S=h.reduce((A,$)=>A+$.amount,0),D=new Date().getMonth(),K=new Date().getFullYear(),U=h.filter(A=>{const $=new Date(A.created_at);return $.getMonth()===D&&$.getFullYear()===K}).reduce((A,$)=>A+$.amount,0),Z=o.filter(A=>A.status==="pending").reduce((A,$)=>A+$.amount,0);v(S),_(U),m(Z)},W=async()=>{if(a){n(!0);try{const{error:o}=await C.from("consultants").update({paypal_email:l}).eq("id",a.id);if(o)throw o;y(l),p(!1),s({title:"PayPal email updated",description:"Your payment information has been updated successfully."})}catch(o){console.error("Error updating PayPal email:",o),s({title:"Error updating PayPal email",description:o.message,variant:"destructive"})}finally{n(!1)}}},Q=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(P,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"Total Earnings"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(qe,{className:"mr-2 h-4 w-4 text-mental-green-500"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",x.toFixed(2)]})]})})]}),e.jsxs(P,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"This Month"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{className:"mr-2 h-4 w-4 text-mental-green-500"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",f.toFixed(2)]})]})})]}),e.jsxs(P,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"Pending Payout"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4 text-mental-green-500"}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",c.toFixed(2)]})]})})]})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Payment Information"}),e.jsx(R,{children:"Update your payment details and preferences."})]}),e.jsx(T,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(z,{htmlFor:"paypal-email",children:"PayPal Email"}),b?e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(q,{id:"paypal-email",value:l,onChange:o=>N(o.target.value),placeholder:"your-paypal@example.com",className:"flex-1",disabled:g}),e.jsx(k,{onClick:W,disabled:g,children:g?"Saving...":"Save"}),e.jsx(k,{variant:"outline",onClick:()=>{p(!1),N(i)},disabled:g,children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{id:"paypal-email",value:i||"No PayPal email set",disabled:!0,className:"bg-muted"}),e.jsx(k,{onClick:()=>p(!0),disabled:g,children:"Change"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"All payments will be sent to this PayPal email address."})]})})})]}),e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Transaction History"}),e.jsx(R,{children:"Your recent payment history and session details."})]}),e.jsx(T,{children:g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),e.jsx("p",{children:"Loading transactions..."})]})}):r.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No transactions yet. Complete sessions to see your earnings here."})}):e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(J,{children:[e.jsx(M,{children:"Date"}),e.jsx(M,{children:"Client"}),e.jsx(M,{children:"Description"}),e.jsx(M,{className:"text-right",children:"Amount"}),e.jsx(M,{children:"Status"})]})}),e.jsx(fe,{children:r.map(o=>e.jsxs(J,{children:[e.jsx(L,{children:Q(o.created_at)}),e.jsx(L,{children:o.user_name||"Unknown Client"}),e.jsx(L,{children:o.description}),e.jsxs(L,{className:"text-right",children:["$",o.amount.toFixed(2)]}),e.jsx(L,{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium 
                        ${o.status==="completed"?"bg-green-100 text-green-800":o.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:o.status.charAt(0).toUpperCase()+o.status.slice(1)})})]},o.id))})]})})]})]})}var ne="Checkbox",[Je,Ps]=Ce(ne),[es,ss]=Je(ne),je=d.forwardRef((s,a)=>{const{__scopeCheckbox:t,name:r,checked:u,defaultChecked:i,required:y,disabled:b,value:p="on",onCheckedChange:l,form:N,...g}=s,[n,x]=d.useState(null),v=Se(a,j=>x(j)),f=d.useRef(!1),_=n?N||!!n.closest("form"):!0,[c=!1,m]=_e({prop:u,defaultProp:i,onChange:l}),w=d.useRef(c);return d.useEffect(()=>{const j=n?.form;if(j){const E=()=>m(w.current);return j.addEventListener("reset",E),()=>j.removeEventListener("reset",E)}},[n,m]),e.jsxs(es,{scope:t,state:c,disabled:b,children:[e.jsx(de.button,{type:"button",role:"checkbox","aria-checked":O(c)?"mixed":c,"aria-required":y,"data-state":be(c),"data-disabled":b?"":void 0,disabled:b,value:p,...g,ref:v,onKeyDown:le(s.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:le(s.onClick,j=>{m(E=>O(E)?!0:!E),_&&(f.current=j.isPropagationStopped(),f.current||j.stopPropagation())})}),_&&e.jsx(ts,{control:n,bubbles:!f.current,name:r,value:p,checked:c,required:y,disabled:b,form:N,style:{transform:"translateX(-100%)"},defaultChecked:O(i)?!1:i})]})});je.displayName=ne;var ye="CheckboxIndicator",ve=d.forwardRef((s,a)=>{const{__scopeCheckbox:t,forceMount:r,...u}=s,i=ss(ye,t);return e.jsx(Ee,{present:r||O(i.state)||i.state===!0,children:e.jsx(de.span,{"data-state":be(i.state),"data-disabled":i.disabled?"":void 0,...u,ref:a,style:{pointerEvents:"none",...s.style}})})});ve.displayName=ye;var ts=s=>{const{control:a,checked:t,bubbles:r=!0,defaultChecked:u,...i}=s,y=d.useRef(null),b=Ie(t),p=ke(a);d.useEffect(()=>{const N=y.current,g=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(g,"checked").set;if(b!==t&&x){const v=new Event("click",{bubbles:r});N.indeterminate=O(t),x.call(N,O(t)?!1:t),N.dispatchEvent(v)}},[b,t,r]);const l=d.useRef(O(t)?!1:t);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:u??l.current,...i,tabIndex:-1,ref:y,style:{...s.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function O(s){return s==="indeterminate"}function be(s){return O(s)?"indeterminate":s?"checked":"unchecked"}var Ne=je,as=ve;const we=d.forwardRef(({className:s,...a},t)=>e.jsx(Ne,{ref:t,className:ce("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:e.jsx(as,{className:ce("flex items-center justify-center text-current"),children:e.jsx(Ae,{className:"h-4 w-4"})})}));we.displayName=Ne.displayName;const te=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],rs=["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"];function is(){const{user:s}=V(),{toast:a}=G(),[t,r]=d.useState(!1),[u,i]=d.useState(!1),[y,b]=d.useState(te.map(n=>({day:n,slots:[]})));d.useEffect(()=>{s&&p()},[s]);const p=async()=>{if(s){r(!0);try{const{data:n,error:x}=await C.from("consultants").select("available").eq("id",s.id).single();if(x)throw x;i(n?.available||!1);const{data:v,error:f}=await C.from("consultant_availability").select("*").eq("consultant_id",s.id);if(f)throw f;const _=te.map((c,m)=>{const w=v?.filter(j=>j.day_of_week===m+1)?.map(j=>j.start_time.substring(0,5))||[];return{day:c,slots:w}});b(_)}catch(n){console.error("Error fetching availability:",n),a({title:"Error fetching availability",description:n.message||"Could not load your availability settings.",variant:"destructive"})}finally{r(!1)}}},l=async()=>{if(s){r(!0);try{const n=!u,{error:x}=await C.from("consultants").update({available:n}).eq("id",s.id);if(x)throw x;i(n),a({title:n?"You are now available":"You are now unavailable",description:n?"Clients can now book sessions with you.":"You won't receive new booking requests."})}catch(n){console.error("Error updating availability:",n),a({title:"Error updating availability",description:n.message||"Could not update your availability status.",variant:"destructive"})}finally{r(!1)}}},N=(n,x)=>{b(v=>v.map(f=>{if(f.day!==n)return f;const _=new Set(f.slots);return _.has(x)?_.delete(x):_.add(x),{...f,slots:Array.from(_)}}))},g=async()=>{if(s){r(!0);try{const{error:n}=await C.from("consultant_availability").delete().eq("consultant_id",s.id);if(n)throw n;const x=[];for(const v of y){const f=te.indexOf(v.day)+1;for(const _ of v.slots){const[c,m]=_.split(":").map(Number),j=`${(c+1).toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:00`;x.push({consultant_id:s.id,day_of_week:f,start_time:`${_}:00`,end_time:j})}}if(x.length>0){const{error:v}=await C.from("consultant_availability").insert(x);if(v)throw v}a({title:"Availability updated",description:"Your availability schedule has been saved successfully."})}catch(n){console.error("Error saving availability:",n),a({title:"Error saving availability",description:n.message||"Could not save your availability schedule.",variant:"destructive"})}finally{r(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Availability Status"}),e.jsx(R,{children:"Toggle your availability to receive booking requests from clients."})]}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Pe,{id:"availability-mode",checked:u,onCheckedChange:l,disabled:t}),e.jsx(z,{htmlFor:"availability-mode",className:"text-base",children:u?"Available for bookings":"Not available for bookings"})]})})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Weekly Schedule"}),e.jsx(R,{children:"Configure your available time slots for each day of the week."})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(k,{variant:"outline",size:"sm",className:"flex items-center",onClick:p,disabled:t,children:[e.jsx(re,{className:"mr-1 h-4 w-4"}),t?"Loading...":"Refresh"]}),e.jsxs(k,{size:"sm",className:"flex items-center",onClick:g,disabled:t,children:[e.jsx($e,{className:"mr-1 h-4 w-4"}),t?"Saving...":"Save Schedule"]})]})]}),e.jsx(T,{children:e.jsx("div",{className:"space-y-6",children:y.map(n=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:n.day}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:rs.map(x=>e.jsxs("div",{className:"flex items-center space-x-2 border rounded p-2",children:[e.jsx(we,{id:`${n.day}-${x}`,checked:n.slots.includes(x),onCheckedChange:()=>N(n.day,x),disabled:t}),e.jsx("label",{htmlFor:`${n.day}-${x}`,className:"text-sm cursor-pointer",children:x})]},`${n.day}-${x}`))})]},n.day))})})]})]})}function ns(){const{user:s,isConsultant:a}=V(),{toast:t}=G(),[r,u]=d.useState(!0),[i,y]=d.useState([]),[b,p]=d.useState(null),l=async()=>{if(!s){p("User not authenticated"),u(!1);return}u(!0),p(null);try{console.log("Fetching sessions for user:",s.id,"isConsultant:",a);let c;a?c=C.from("sessions").select("*").eq("consultant_id",s.id).order("start_time",{ascending:!1}):c=C.from("sessions").select("*").eq("user_id",s.id).order("start_time",{ascending:!1}),console.log("Executing sessions query...");const{data:m,error:w}=await c;if(w)throw console.error("Sessions query error:",w),new Error(`Failed to fetch sessions: ${w.message}`);if(console.log("Raw session data:",m),!m||m.length===0){console.log("No sessions found"),y([]);return}const j=new Set;m.forEach(o=>{a?j.add(o.user_id):j.add(o.consultant_id)}),console.log("Fetching user data for IDs:",Array.from(j));const{data:E,error:W}=await C.from("users").select("id, name, profile_image").in("id",Array.from(j));if(W)throw console.error("Users query error:",W),new Error(`Failed to fetch user data: ${W.message}`);console.log("Users data:",E);const Q=m.map(o=>{console.log("Transforming session:",o);const h=a?o.user_id:o.consultant_id,S=E?.find(D=>D.id===h);return{id:o.id,user_id:o.user_id,consultant_id:o.consultant_id,start_time:o.start_time,end_time:o.end_time,status:o.status,notes:o.notes,created_at:o.created_at,user:S?{name:S.name||"Unknown User",profile_image:S.profile_image||null}:null}});console.log("Transformed sessions:",Q),y(Q)}catch(c){console.error("Error fetching sessions:",c);const m=c.message||"Could not load your sessions.";p(m),t({title:"Error fetching sessions",description:m,variant:"destructive"})}finally{u(!1)}},N=async(c,m)=>{if(!s||!a){t({title:"Unauthorized",description:"Only consultants can update session status.",variant:"destructive"});return}u(!0);try{console.log("Updating session status:",c,m);const{error:w}=await C.from("sessions").update({status:m}).eq("id",c).eq("consultant_id",s.id);if(w)throw console.error("Error updating session:",w),new Error(`Failed to update session: ${w.message}`);y(j=>j.map(E=>E.id===c?{...E,status:m}:E)),t({title:"Session updated",description:`The session has been marked as ${m}.`})}catch(w){console.error("Update session error:",w),t({title:"Error updating session",description:w.message||"Could not update the session status.",variant:"destructive"})}finally{u(!1)}},g=i.filter(c=>(c.status==="scheduled"||c.status==="pending_payment_confirmation")&&Ve(X(c.start_time),new Date)),n=i.filter(c=>c.status==="completed"||c.status!=="cancelled"&&We(X(c.start_time),new Date)),x=i.filter(c=>c.status==="cancelled");return{sessions:i,isLoading:r,error:b,upcomingSessions:g,pastSessions:n,cancelledSessions:x,fetchSessions:l,updateSessionStatus:N,formatSessionDate:c=>{try{const m=X(c);return ie(m,"MMM dd, yyyy")}catch(m){return console.error("Error formatting date:",m),"Invalid date"}},formatSessionTime:c=>{try{const m=X(c);return ie(m,"h:mm a")}catch(m){return console.error("Error formatting time:",m),"Invalid time"}},getSessionDuration:(c,m)=>{try{const w=X(c);return`${(X(m).getTime()-w.getTime())/(1e3*60)} min`}catch(w){return console.error("Error calculating duration:",w),"Unknown duration"}}}}function ls(){const{isConsultant:s}=V(),{isLoading:a,error:t,upcomingSessions:r,pastSessions:u,cancelledSessions:i,fetchSessions:y,updateSessionStatus:b,formatSessionDate:p,formatSessionTime:l,getSessionDuration:N}=ns();d.useEffect(()=>{y()},[]);const g=v=>{switch(v){case"scheduled":return"outline";case"completed":return"default";case"pending_payment_confirmation":return"secondary";case"cancelled":return"destructive";default:return"outline"}},n=v=>{switch(v){case"pending_payment_confirmation":return"Pending Payment";default:return v.charAt(0).toUpperCase()+v.slice(1)}},x=v=>e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(J,{children:[e.jsx(M,{children:s?"Client":"Consultant"}),e.jsx(M,{children:"Date"}),e.jsx(M,{children:"Time"}),e.jsx(M,{children:"Duration"}),e.jsx(M,{children:"Status"}),s&&e.jsx(M,{children:"Actions"})]})}),e.jsxs(fe,{children:[v.length===0&&e.jsx(J,{children:e.jsx(L,{colSpan:s?6:5,className:"text-center py-4",children:"No sessions found"})}),v.map(f=>e.jsxs(J,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-100 overflow-hidden",children:f.user?.profile_image?e.jsx("img",{src:f.user.profile_image,alt:f.user?.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-mental-green-100 text-mental-green-800",children:f.user?.name?.charAt(0)?.toUpperCase()||"U"})}),e.jsx("span",{className:"font-medium",children:f.user?.name||"Unknown User"})]})}),e.jsx(L,{children:p(f.start_time)}),e.jsx(L,{children:l(f.start_time)}),e.jsx(L,{children:N(f.start_time,f.end_time)}),e.jsx(L,{children:e.jsx(H,{variant:g(f.status),children:n(f.status)})}),s&&e.jsx(L,{children:e.jsx("div",{className:"flex space-x-2",children:(f.status==="scheduled"||f.status==="pending_payment_confirmation")&&e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>b(f.id,"completed"),children:"Complete"}),e.jsx(k,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",onClick:()=>b(f.id,"cancelled"),children:"Cancel"})]})})})]},f.id))]})]});return t?e.jsx("div",{className:"space-y-6",children:e.jsx(P,{children:e.jsx(T,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 font-medium",children:"Error loading sessions"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t}),e.jsxs(k,{onClick:y,variant:"outline",size:"sm",className:"mt-4",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Try Again"]})]})})})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Your Sessions"}),e.jsx(R,{children:s?"Manage your upcoming and past client sessions.":"View your upcoming and past consultation sessions."})]}),e.jsxs(k,{variant:"outline",size:"sm",className:"flex items-center",onClick:y,disabled:a,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})}),e.jsx(T,{children:e.jsxs(xe,{defaultValue:"upcoming",children:[e.jsxs(pe,{className:"mb-4",children:[e.jsxs(Y,{value:"upcoming",children:["Upcoming",r.length>0&&e.jsx(H,{variant:"secondary",className:"ml-2",children:r.length})]}),e.jsxs(Y,{value:"past",children:["Past",u.length>0&&e.jsx(H,{variant:"secondary",className:"ml-2",children:u.length})]}),e.jsxs(Y,{value:"cancelled",children:["Cancelled",i.length>0&&e.jsx(H,{variant:"secondary",className:"ml-2",children:i.length})]})]}),e.jsx(B,{value:"upcoming",className:"pt-2",children:a?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading upcoming sessions..."})}):x(r)}),e.jsx(B,{value:"past",className:"pt-2",children:a?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading past sessions..."})}):x(u)}),e.jsx(B,{value:"cancelled",className:"pt-2",children:a?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading cancelled sessions..."})}):x(i)})]})})]})})}function os(){const{user:s}=V(),{toast:a}=G(),[t,r]=d.useState(!0),[u,i]=d.useState([]);d.useEffect(()=>{s&&y()},[s]);const y=async()=>{if(s){r(!0);try{const{data:p,error:l}=await C.from("stories").select("*").eq("author_id",s.id).order("published_at",{ascending:!1});if(l)throw l;const N=p?p.map(g=>({id:g.id,title:g.title,snippet:g.snippet,content:g.content,cover_image:g.cover_image,tags:g.tags,tag_type:g.tag_type||"mental",author_id:g.author_id,is_featured:g.is_featured,published_at:g.published_at,created_at:g.created_at,updated_at:g.updated_at})):[];i(N)}catch(p){a({title:"Error fetching stories",description:p.message||"Could not load your stories.",variant:"destructive"})}finally{r(!1)}}};return{stories:u,isLoading:t,handleDeleteStory:async p=>{if(confirm("Are you sure you want to delete this story? This action cannot be undone."))try{const{error:l}=await C.from("stories").delete().eq("id",p).eq("author_id",s?.id);if(l)throw l;i(N=>N.filter(g=>g.id!==p)),a({title:"Story deleted",description:"Your story has been deleted successfully."})}catch(l){a({title:"Error deleting story",description:l.message||"Could not delete your story.",variant:"destructive"})}},refetchStories:y}}function cs({story:s,onEdit:a,onDelete:t}){const r=u=>{try{const i=X(u);return ie(i,"MMM dd, yyyy")}catch{return u}};return e.jsxs(P,{className:"overflow-hidden border",children:[e.jsxs("div",{className:"aspect-video relative",children:[e.jsx("img",{src:s.cover_image||"/placeholder.svg",alt:s.title,className:"object-cover w-full h-full"}),s.is_featured&&e.jsx(H,{className:"absolute top-2 right-2 bg-mental-green-600",children:"Featured"})]}),e.jsxs(F,{className:"pb-2",children:[e.jsx(I,{className:"line-clamp-1",children:s.title}),e.jsx("div",{className:"flex items-center text-sm text-muted-foreground",children:e.jsxs("span",{children:["Published on ",r(s.published_at)]})})]}),e.jsxs(T,{className:"pb-2",children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.snippet}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.tags.slice(0,3).map(u=>e.jsx(H,{variant:"outline",className:"text-xs",children:u},u)),s.tags.length>3&&e.jsxs(H,{variant:"outline",className:"text-xs",children:["+",s.tags.length-3," more"]})]})]}),e.jsxs(Le,{className:"justify-between pt-2",children:[e.jsx(ze,{to:`/story/${s.id}`,children:e.jsxs(k,{variant:"outline",size:"sm",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Read"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>a(s),children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"sm",className:"text-red-500 hover:bg-red-50 hover:text-red-600",onClick:()=>t(s.id),children:e.jsx(De,{className:"h-4 w-4"})})]})]})]})}function ds(){return e.jsxs("div",{className:"text-center py-10 space-y-4",children:[e.jsx(ue,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"No stories yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Share your insights and experiences by creating your first story."})]}),e.jsx(ae,{children:e.jsxs(k,{className:"mt-4",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Create Your First Story"]})})]})}function us(){const{stories:s,isLoading:a,handleDeleteStory:t}=os(),[r,u]=d.useState(null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Your Stories"}),e.jsx(R,{children:"Manage stories you've shared on the platform."})]}),e.jsx(ae,{})]}),e.jsx(T,{children:a?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("p",{children:"Loading your stories..."})}):s.length===0?e.jsx(ds,{}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(i=>e.jsx(cs,{story:i,onEdit:u,onDelete:t},i.id))})})]}),r&&e.jsx(ae,{story:r,onOpenChange:()=>u(null)})]})}function Ts(){const{profile:s,isConsultant:a,isAdmin:t}=V();return s?e.jsx(oe,{children:e.jsxs("div",{className:"container mx-auto py-6 px-4 pb-20 sm:pb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Your Profile"}),e.jsxs(xe,{defaultValue:"settings",className:"w-full",children:[e.jsxs(pe,{className:"mb-4",children:[e.jsx(Y,{value:"settings",children:"Settings"}),a&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{value:"finances",children:"Finances"}),e.jsx(Y,{value:"availability",children:"Availability"})]}),e.jsx(Y,{value:"sessions",children:"Sessions"}),e.jsx(Y,{value:"stories",children:"Stories"})]}),e.jsx(B,{value:"settings",children:e.jsx(Qe,{isConsultant:a,isAdmin:t})}),a&&e.jsxs(e.Fragment,{children:[e.jsx(B,{value:"finances",children:e.jsx(Ze,{})}),e.jsx(B,{value:"availability",children:e.jsx(is,{})})]}),e.jsx(B,{value:"sessions",children:e.jsx(ls,{})}),e.jsx(B,{value:"stories",children:e.jsx(us,{})})]})]})}):e.jsx(oe,{children:e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Loading profile..."})})})}export{Ts as ProfilePage,Ts as default};
